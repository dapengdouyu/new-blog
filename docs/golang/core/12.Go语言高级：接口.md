---
title: 12ã€Goè¯­è¨€é«˜çº§ï¼šæ¥å£
date: 2026-01-06
description: æ·±å…¥ç†è§£Goè¯­è¨€çš„æ¥å£æœºåˆ¶ï¼ŒåŒ…æ‹¬æ¥å£å®šä¹‰ã€å¤šæ€ã€ç©ºæ¥å£ã€ç±»å‹æ–­è¨€å’Œæ¥å£ç»„åˆ
---

# 11ã€Goè¯­è¨€é«˜çº§ï¼šæ¥å£

æœ¬æ–‡æ¡£æ·±å…¥è®²è§£Goè¯­è¨€çš„æ¥å£ï¼ˆInterfaceï¼‰æœºåˆ¶ã€‚æ¥å£æ˜¯Goè¯­è¨€ä¸­å®ç°å¤šæ€çš„æ ¸å¿ƒæœºåˆ¶ï¼Œæä¾›äº†çµæ´»çš„ç±»å‹æŠ½è±¡å’Œä»£ç ç»„ç»‡æ–¹å¼ã€‚

## ğŸ¯ æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… ç†è§£æ¥å£çš„æ¦‚å¿µå’Œå®ç°æ–¹å¼
- âœ… æŒæ¡æ¥å£çš„å¤šæ€åº”ç”¨
- âœ… äº†è§£ç©ºæ¥å£çš„ä½¿ç”¨æ–¹æ³•
- âœ… æŒæ¡ç±»å‹æ–­è¨€å’Œç±»å‹å¼€å…³
- âœ… ç†è§£æ¥å£ç»„åˆçš„è®¾è®¡æ¨¡å¼
- âœ… æŒæ¡æ¥å£çš„å®é™…åº”ç”¨åœºæ™¯

---

## ä¸€ã€æ¥å£ï¼ˆInterfaceï¼‰

### 1.1 ä»€ä¹ˆæ˜¯æ¥å£ï¼Ÿ

æ¥å£æ˜¯Goè¯­è¨€ä¸­å®ç°å¤šæ€çš„æ ¸å¿ƒæœºåˆ¶ã€‚æ¥å£å®šä¹‰äº†ä¸€ç»„æ–¹æ³•çš„ç­¾åï¼Œä»»ä½•å®ç°äº†è¿™äº›æ–¹æ³•çš„ç±»å‹éƒ½éšå¼åœ°å®ç°äº†è¯¥æ¥å£ã€‚

#### åŸºæœ¬å®šä¹‰

```go
package main

import "fmt"

// å®šä¹‰æ¥å£
type Writer interface {
    Write([]byte) (int, error)
}

// å®šä¹‰ç»“æ„ä½“
type File struct {
    name string
}

// å®ç°æ¥å£æ–¹æ³•ï¼ˆéšå¼å®ç°ï¼‰
func (f File) Write(data []byte) (int, error) {
    fmt.Printf("å†™å…¥æ–‡ä»¶ %s: %s\n", f.name, string(data))
    return len(data), nil
}

func main() {
    var w Writer
    f := File{name: "test.txt"}
    w = f  // Fileå®ç°äº†Writeræ¥å£
    w.Write([]byte("Hello, Go!"))
}
```

#### æ¥å£çš„ç‰¹ç‚¹

1. **éšå¼å®ç°**ï¼šä¸éœ€è¦æ˜¾å¼å£°æ˜å®ç°æ¥å£
2. **ç±»å‹å®‰å…¨**ï¼šç¼–è¯‘æ—¶æ£€æŸ¥æ¥å£å®ç°
3. **é›¶å€¼**ï¼šæ¥å£çš„é›¶å€¼æ˜¯ `nil`

```go
var w Writer  // w æ˜¯ nil
fmt.Println(w == nil)  // true
```

---

### 1.2 ç©ºæ¥å£ï¼ˆEmpty Interfaceï¼‰

ç©ºæ¥å£ `interface{}` å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„ `Object` æˆ– `any`ã€‚

```go
package main

import "fmt"

func main() {
    // ç©ºæ¥å£å¯ä»¥å­˜å‚¨ä»»ä½•ç±»å‹çš„å€¼
    var i interface{}

    i = 42
    fmt.Printf("ç±»å‹: %T, å€¼: %v\n", i, i)  // int, 42

    i = "hello"
    fmt.Printf("ç±»å‹: %T, å€¼: %v\n", i, i)  // string, hello

    i = []int{1, 2, 3}
    fmt.Printf("ç±»å‹: %T, å€¼: %v\n", i, i)  // []int, [1 2 3]
}
```

#### ç±»å‹æ–­è¨€ï¼ˆType Assertionï¼‰

ä½¿ç”¨ç±»å‹æ–­è¨€å¯ä»¥è·å–æ¥å£åº•å±‚å€¼çš„å…·ä½“ç±»å‹ï¼š

```go
package main

import "fmt"

func main() {
    var i interface{} = "hello"

    // æ–¹å¼1ï¼šå®‰å…¨æ–­è¨€ï¼ˆæ¨èï¼‰
    s, ok := i.(string)
    if ok {
        fmt.Println("æ˜¯å­—ç¬¦ä¸²:", s)
    }

    // æ–¹å¼2ï¼šç›´æ¥æ–­è¨€ï¼ˆå¦‚æœå¤±è´¥ä¼španicï¼‰
    s2 := i.(string)
    fmt.Println(s2)

    // ç±»å‹æ–­è¨€å¤±è´¥ç¤ºä¾‹
    f, ok := i.(float64)
    if !ok {
        fmt.Println("ä¸æ˜¯float64ç±»å‹")
    }
}
```

#### ç±»å‹å¼€å…³ï¼ˆType Switchï¼‰

ä½¿ç”¨ç±»å‹å¼€å…³å¯ä»¥å¤„ç†å¤šç§ç±»å‹ï¼š

```go
package main

import "fmt"

func printType(i interface{}) {
    switch v := i.(type) {
    case int:
        fmt.Printf("æ•´æ•°: %d\n", v)
    case string:
        fmt.Printf("å­—ç¬¦ä¸²: %s\n", v)
    case bool:
        fmt.Printf("å¸ƒå°”å€¼: %t\n", v)
    default:
        fmt.Printf("æœªçŸ¥ç±»å‹: %T\n", v)
    }
}

func main() {
    printType(42)        // æ•´æ•°: 42
    printType("hello")  // å­—ç¬¦ä¸²: hello
    printType(true)     // å¸ƒå°”å€¼: true
    printType(3.14)     // æœªçŸ¥ç±»å‹: float64
}
```

---

### 1.3 æ¥å£ç»„åˆ

Goè¯­è¨€æ”¯æŒæ¥å£ç»„åˆï¼Œé€šè¿‡ç»„åˆå¤šä¸ªæ¥å£åˆ›å»ºæ–°æ¥å£ï¼š

```go
package main

import "fmt"

// åŸºç¡€æ¥å£
type Reader interface {
    Read([]byte) (int, error)
}

type Writer interface {
    Write([]byte) (int, error)
}

// ç»„åˆæ¥å£
type ReadWriter interface {
    Reader
    Writer
}

// å®ç°ç»„åˆæ¥å£
type File struct {
    name string
    data []byte
}

func (f *File) Read(p []byte) (int, error) {
    copy(p, f.data)
    return len(f.data), nil
}

func (f *File) Write(p []byte) (int, error) {
    f.data = append(f.data, p...)
    return len(p), nil
}

func main() {
    var rw ReadWriter = &File{name: "test.txt"}
    rw.Write([]byte("Hello"))

    buf := make([]byte, 10)
    n, _ := rw.Read(buf)
    fmt.Println(string(buf[:n]))  // Hello
}
```

---

### 1.4 æ¥å£çš„å®é™…åº”ç”¨

#### ç¤ºä¾‹1ï¼šå¤šæ€å®ç°

```go
package main

import "fmt"

// å®šä¹‰æ¥å£
type Shape interface {
    Area() float64
    Perimeter() float64
}

// çŸ©å½¢
type Rectangle struct {
    Width  float64
    Height float64
}

func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

func (r Rectangle) Perimeter() float64 {
    return 2 * (r.Width + r.Height)
}

// åœ†å½¢
type Circle struct {
    Radius float64
}

func (c Circle) Area() float64 {
    return 3.14159 * c.Radius * c.Radius
}

func (c Circle) Perimeter() float64 {
    return 2 * 3.14159 * c.Radius
}

// å¤šæ€å‡½æ•°
func printShapeInfo(s Shape) {
    fmt.Printf("é¢ç§¯: %.2f, å‘¨é•¿: %.2f\n", s.Area(), s.Perimeter())
}

func main() {
    shapes := []Shape{
        Rectangle{Width: 5, Height: 3},
        Circle{Radius: 4},
    }

    for _, shape := range shapes {
        printShapeInfo(shape)
    }
}
```

#### ç¤ºä¾‹2ï¼šä¾èµ–æ³¨å…¥

```go
package main

import "fmt"

// æ•°æ®åº“æ¥å£
type Database interface {
    Save(data string) error
    Load(id string) (string, error)
}

// MySQLå®ç°
type MySQL struct{}

func (m MySQL) Save(data string) error {
    fmt.Printf("MySQLä¿å­˜: %s\n", data)
    return nil
}

func (m MySQL) Load(id string) (string, error) {
    return fmt.Sprintf("MySQLæ•°æ®-%s", id), nil
}

// PostgreSQLå®ç°
type PostgreSQL struct{}

func (p PostgreSQL) Save(data string) error {
    fmt.Printf("PostgreSQLä¿å­˜: %s\n", data)
    return nil
}

func (p PostgreSQL) Load(id string) (string, error) {
    return fmt.Sprintf("PostgreSQLæ•°æ®-%s", id), nil
}

// æœåŠ¡å±‚ï¼ˆä¾èµ–æ¥å£è€Œéå…·ä½“å®ç°ï¼‰
type UserService struct {
    db Database
}

func NewUserService(db Database) *UserService {
    return &UserService{db: db}
}

func (s *UserService) CreateUser(name string) error {
    return s.db.Save(name)
}

func main() {
    // å¯ä»¥è½»æ¾åˆ‡æ¢ä¸åŒçš„æ•°æ®åº“å®ç°
    mysqlService := NewUserService(MySQL{})
    mysqlService.CreateUser("Alice")

    pgService := NewUserService(PostgreSQL{})
    pgService.CreateUser("Bob")
}
```

---

### 1.5 æ¥å£çš„æ³¨æ„äº‹é¡¹

#### 1. æŒ‡é’ˆæ¥æ”¶è€… vs å€¼æ¥æ”¶è€…

```go
package main

import "fmt"

type Writer interface {
    Write([]byte) (int, error)
}

// å€¼æ¥æ”¶è€…
type ValueReceiver struct{}

func (v ValueReceiver) Write(data []byte) (int, error) {
    return len(data), nil
}

// æŒ‡é’ˆæ¥æ”¶è€…
type PointerReceiver struct{}

func (p *PointerReceiver) Write(data []byte) (int, error) {
    return len(data), nil
}

func main() {
    var w1 Writer = ValueReceiver{}        // âœ… å¯ä»¥
    var w2 Writer = &ValueReceiver{}       // âœ… ä¹Ÿå¯ä»¥ï¼ˆå€¼æ¥æ”¶è€…å¯ä»¥æ¥å—æŒ‡é’ˆï¼‰

    // var w3 Writer = PointerReceiver{}   // âŒ é”™è¯¯ï¼æŒ‡é’ˆæ¥æ”¶è€…ä¸èƒ½æ¥å—å€¼
    var w4 Writer = &PointerReceiver{}     // âœ… å¯ä»¥
}
```

#### 2. nilæ¥å£ vs nilå€¼

```go
package main

import "fmt"

type Writer interface {
    Write([]byte) (int, error)
}

type File struct {
    name string
}

func (f *File) Write(data []byte) (int, error) {
    return len(data), nil
}

func main() {
    var w Writer
    fmt.Println(w == nil)  // trueï¼ˆnilæ¥å£ï¼‰

    var f *File = nil
    w = f
    fmt.Println(w == nil)  // falseï¼ï¼ˆæ¥å£å€¼ä¸æ˜¯nilï¼Œè™½ç„¶åº•å±‚å€¼æ˜¯nilï¼‰
    fmt.Println(f == nil)  // trueï¼ˆåº•å±‚å€¼æ˜¯nilï¼‰
}
```

---

## æ€»ç»“

### æ¥å£ï¼ˆInterfaceï¼‰

1. **éšå¼å®ç°**ï¼šç±»å‹ä¸éœ€è¦æ˜¾å¼å£°æ˜å®ç°æ¥å£ï¼Œåªè¦å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•å³å¯
2. **å¤šæ€**ï¼šé€šè¿‡æ¥å£å®ç°å¤šæ€ï¼Œæé«˜ä»£ç çš„çµæ´»æ€§å’Œå¯æ‰©å±•æ€§
3. **ç©ºæ¥å£**ï¼š`interface{}` å¯ä»¥è¡¨ç¤ºä»»ä½•ç±»å‹ï¼Œé…åˆç±»å‹æ–­è¨€å’Œç±»å‹å¼€å…³ä½¿ç”¨
4. **æ¥å£ç»„åˆ**ï¼šé€šè¿‡ç»„åˆå¤šä¸ªæ¥å£åˆ›å»ºæ–°æ¥å£ï¼Œå®ç°æ¥å£çš„å¤ç”¨
5. **æ³¨æ„äº‹é¡¹**ï¼šæ³¨æ„æŒ‡é’ˆæ¥æ”¶è€…å’Œå€¼æ¥æ”¶è€…çš„åŒºåˆ«ï¼Œç†è§£nilæ¥å£å’Œnilå€¼çš„åŒºåˆ«

### æœ€ä½³å®è·µ

1. **æ¥å£è®¾è®¡åŸåˆ™**ï¼š
   - æ¥å£åº”è¯¥å°è€Œä¸“æ³¨ï¼ˆå•ä¸€èŒè´£ï¼‰
   - ä½¿ç”¨æ¥å£ç»„åˆè€Œéç»§æ‰¿
   - ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è€…è€Œä¸æ˜¯å®ç°è€…
2. **å®é™…åº”ç”¨**ï¼š
   - ä½¿ç”¨æ¥å£å®ç°ä¾èµ–å€’ç½®
   - é€šè¿‡æ¥å£å®ç°æµ‹è¯•æ›¿èº«ï¼ˆmockï¼‰
   - ä½¿ç”¨ç©ºæ¥å£å¤„ç†ä¸ç¡®å®šç±»å‹
3. **æ€§èƒ½è€ƒè™‘**ï¼š
   - æ¥å£è°ƒç”¨æœ‰å°‘é‡æ€§èƒ½å¼€é”€
   - å¤§é‡ä½¿ç”¨ç©ºæ¥å£å¯èƒ½å½±å“ç±»å‹å®‰å…¨
   - åœ¨æ€§èƒ½æ•æ„Ÿçš„ä»£ç ä¸­è€ƒè™‘å…·ä½“ç±»å‹

æŒæ¡æ¥å£æ˜¯ç¼–å†™çµæ´»ã€å¯æ‰©å±•Goä»£ç çš„åŸºç¡€ã€‚é€šè¿‡åˆç†ä½¿ç”¨æ¥å£ï¼Œå¯ä»¥å®ç°æ¾è€¦åˆçš„è®¾è®¡ï¼Œæé«˜ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚