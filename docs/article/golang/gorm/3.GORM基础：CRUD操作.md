---
title: 3ã€GORMåŸºç¡€ï¼šCRUDæ“ä½œ
date: 2026-01-09
description: æŒæ¡GORMçš„å®Œæ•´CRUDæ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°å’Œåˆ é™¤
---

# 3ã€GORMåŸºç¡€ï¼šCRUDæ“ä½œ

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»GORMçš„CRUDï¼ˆCreateã€Readã€Updateã€Deleteï¼‰æ“ä½œï¼Œè¿™æ˜¯æ•°æ®åº“åº”ç”¨å¼€å‘çš„æ ¸å¿ƒã€‚

## ğŸ¯ æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… æŒæ¡åˆ›å»ºè®°å½•çš„å„ç§æ–¹æ³•
- âœ… å­¦ä¼šæŸ¥è¯¢å•ä¸ªå’Œå¤šä¸ªè®°å½•
- âœ… ç†è§£æ›´æ–°æ“ä½œçš„ä¸åŒæ–¹å¼
- âœ… æŒæ¡åˆ é™¤æ“ä½œï¼ˆç¡¬åˆ é™¤å’Œè½¯åˆ é™¤ï¼‰
- âœ… å­¦ä¼šæ‰¹é‡æ“ä½œå’Œé”™è¯¯å¤„ç†

---

## å‰ç½®çŸ¥è¯†

- **ç¬¬1è¯¾ï¼šGORMå…¥é—¨** - äº†è§£GORMçš„åŸºæœ¬ä½¿ç”¨
- **ç¬¬2è¯¾ï¼šæ¨¡å‹å®šä¹‰** - æŒæ¡æ¨¡å‹çš„å®šä¹‰æ–¹æ³•

---

## ä¸€ã€åˆ›å»ºï¼ˆCreateï¼‰

### 1.1 åˆ›å»ºå•ä¸ªè®°å½•

```go
package main

import (
    "fmt"
    "gorm.io/driver/sqlite"
    "gorm.io/gorm"
)

type User struct {
    ID    uint   `gorm:"primaryKey"`
    Name  string
    Email string
    Age   int
}

func main() {
    db, _ := gorm.Open(sqlite.Open("test.db"), &gorm.Config{})
    db.AutoMigrate(&User{})

    // åˆ›å»ºå•ä¸ªç”¨æˆ·
    user := User{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 25}
    result := db.Create(&user)

    if result.Error != nil {
        fmt.Printf("åˆ›å»ºå¤±è´¥: %v\n", result.Error)
    } else {
        fmt.Printf("åˆ›å»ºæˆåŠŸï¼ŒID: %d, å½±å“è¡Œæ•°: %d\n", user.ID, result.RowsAffected)
    }
}
```

### 1.2 åˆ›å»ºå¤šä¸ªè®°å½•

```go
// æ‰¹é‡åˆ›å»º
users := []User{
    {Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 25},
    {Name: "æå››", Email: "lisi@example.com", Age: 30},
    {Name: "ç‹äº”", Email: "wangwu@example.com", Age: 28},
}

result := db.Create(&users)
fmt.Printf("åˆ›å»ºäº† %d æ¡è®°å½•\n", result.RowsAffected)

// æ‰¹é‡åˆ›å»ºæ—¶ï¼Œæ¯ä¸ªè®°å½•éƒ½ä¼šè·å¾—ID
for _, user := range users {
    fmt.Printf("ç”¨æˆ·: %s, ID: %d\n", user.Name, user.ID)
}
```

### 1.3 æŒ‡å®šå­—æ®µåˆ›å»º

```go
// åªåˆ›å»ºæŒ‡å®šå­—æ®µ
user := User{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 25}
db.Select("Name", "Email").Create(&user)  // åªåˆ›å»ºNameå’ŒEmailå­—æ®µ

// æ’é™¤æŒ‡å®šå­—æ®µ
db.Omit("Age").Create(&user)  // åˆ›å»ºæ—¶æ’é™¤Ageå­—æ®µ
```

### 1.4 åˆ›å»ºæ—¶æ£€æŸ¥é”™è¯¯

```go
user := User{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 25}

// æ–¹å¼1ï¼šæ£€æŸ¥Errorå­—æ®µ
result := db.Create(&user)
if result.Error != nil {
    fmt.Printf("åˆ›å»ºå¤±è´¥: %v\n", result.Error)
    return
}

// æ–¹å¼2ï¼šä½¿ç”¨FirstOrCreateï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰
db.Where("email = ?", "zhangsan@example.com").FirstOrCreate(&user)

// æ–¹å¼3ï¼šä½¿ç”¨CreateInBatchesï¼ˆåˆ†æ‰¹åˆ›å»ºï¼‰
db.CreateInBatches(users, 100)  // æ¯æ‰¹100æ¡
```

---

## äºŒã€æŸ¥è¯¢ï¼ˆReadï¼‰

### 2.1 æŸ¥è¯¢å•ä¸ªè®°å½•

#### First - æŸ¥è¯¢ç¬¬ä¸€æ¡è®°å½•

```go
var user User

// æŸ¥è¯¢ç¬¬ä¸€æ¡è®°å½•ï¼ˆæŒ‰ä¸»é”®æ’åºï¼‰
db.First(&user)
fmt.Printf("ç¬¬ä¸€æ¡è®°å½•: %+v\n", user)

// æŸ¥è¯¢æŒ‡å®šIDçš„è®°å½•
db.First(&user, 1)  // æŸ¥è¯¢IDä¸º1çš„è®°å½•
db.First(&user, "id = ?", 1)  // ä½¿ç”¨æ¡ä»¶æŸ¥è¯¢

// å¤„ç†è®°å½•ä¸å­˜åœ¨çš„æƒ…å†µ
result := db.First(&user, 999)
if errors.Is(result.Error, gorm.ErrRecordNotFound) {
    fmt.Println("è®°å½•ä¸å­˜åœ¨")
}
```

#### Take - éšæœºè·å–ä¸€æ¡è®°å½•

```go
var user User
db.Take(&user)  // ä¸æ’åºï¼Œéšæœºè·å–ä¸€æ¡
```

#### Last - æŸ¥è¯¢æœ€åä¸€æ¡è®°å½•

```go
var user User
db.Last(&user)  // æŒ‰ä¸»é”®é™åºï¼Œè·å–æœ€åä¸€æ¡
```

### 2.2 æŸ¥è¯¢å¤šä¸ªè®°å½•

#### Find - æŸ¥è¯¢æ‰€æœ‰è®°å½•

```go
var users []User

// æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
db.Find(&users)
fmt.Printf("æ‰¾åˆ° %d ä¸ªç”¨æˆ·\n", len(users))

// æŸ¥è¯¢æŒ‡å®šæ¡ä»¶çš„è®°å½•
db.Where("age > ?", 18).Find(&users)

// æŸ¥è¯¢æŒ‡å®šIDçš„è®°å½•
db.Find(&users, []int{1, 2, 3})  // æŸ¥è¯¢IDä¸º1,2,3çš„è®°å½•
```

### 2.3 æ¡ä»¶æŸ¥è¯¢

#### Whereæ¡ä»¶

```go
var users []User

// ç­‰å€¼æŸ¥è¯¢
db.Where("name = ?", "å¼ ä¸‰").Find(&users)

// æ¯”è¾ƒæŸ¥è¯¢
db.Where("age > ?", 18).Find(&users)
db.Where("age >= ?", 18).Find(&users)
db.Where("age < ?", 30).Find(&users)
db.Where("age <= ?", 30).Find(&users)
db.Where("age <> ?", 25).Find(&users)

// INæŸ¥è¯¢
db.Where("name IN ?", []string{"å¼ ä¸‰", "æå››"}).Find(&users)

// LIKEæŸ¥è¯¢
db.Where("name LIKE ?", "%å¼ %").Find(&users)

// ANDæ¡ä»¶
db.Where("age > ? AND name LIKE ?", 18, "%å¼ %").Find(&users)

// ORæ¡ä»¶
db.Where("age > ? OR name LIKE ?", 30, "%å¼ %").Find(&users)

// BETWEENæŸ¥è¯¢
db.Where("age BETWEEN ? AND ?", 20, 30).Find(&users)
```

#### é“¾å¼æŸ¥è¯¢

```go
var users []User

// é“¾å¼è°ƒç”¨
db.Where("age > ?", 18).
   Where("name LIKE ?", "%å¼ %").
   Order("age DESC").
   Limit(10).
   Find(&users)
```

### 2.4 æ’åºå’Œåˆ†é¡µ

#### æ’åºï¼ˆOrderï¼‰

```go
var users []User

// å•å­—æ®µæ’åº
db.Order("age DESC").Find(&users)  // æŒ‰å¹´é¾„é™åº
db.Order("age ASC").Find(&users)   // æŒ‰å¹´é¾„å‡åº

// å¤šå­—æ®µæ’åº
db.Order("age DESC, name ASC").Find(&users)

// éšæœºæ’åº
db.Order("RAND()").Find(&users)
```

#### é™åˆ¶å’Œåç§»ï¼ˆLimit & Offsetï¼‰

```go
var users []User

// é™åˆ¶æ•°é‡
db.Limit(10).Find(&users)  // åªæŸ¥è¯¢10æ¡

// åç§»é‡
db.Offset(10).Find(&users)  // è·³è¿‡å‰10æ¡

// åˆ†é¡µæŸ¥è¯¢
page := 1
pageSize := 10
db.Offset((page - 1) * pageSize).Limit(pageSize).Find(&users)
```

### 2.5 é€‰æ‹©å­—æ®µ

```go
var users []User

// é€‰æ‹©æŒ‡å®šå­—æ®µ
db.Select("name", "email").Find(&users)

// æ’é™¤æŒ‡å®šå­—æ®µ
db.Omit("password", "created_at").Find(&users)
```

### 2.6 è®¡æ•°å’Œå­˜åœ¨æ€§æ£€æŸ¥

```go
var count int64

// ç»Ÿè®¡è®°å½•æ•°
db.Model(&User{}).Where("age > ?", 18).Count(&count)
fmt.Printf("å¹´é¾„å¤§äº18çš„ç”¨æˆ·æ•°: %d\n", count)

// æ£€æŸ¥è®°å½•æ˜¯å¦å­˜åœ¨
var user User
exists := db.Where("email = ?", "zhangsan@example.com").First(&user).Error == nil
if exists {
    fmt.Println("ç”¨æˆ·å­˜åœ¨")
}
```

---

## ä¸‰ã€æ›´æ–°ï¼ˆUpdateï¼‰

### 3.1 æ›´æ–°å•ä¸ªå­—æ®µ

```go
var user User
db.First(&user, 1)

// æ›´æ–°å•ä¸ªå­—æ®µ
db.Model(&user).Update("name", "æ–°åå­—")

// ä½¿ç”¨mapæ›´æ–°
db.Model(&user).Updates(map[string]interface{}{
    "name": "æ–°åå­—",
    "age":  26,
})
```

### 3.2 æ›´æ–°å¤šä¸ªå­—æ®µ

```go
var user User
db.First(&user, 1)

// æ›´æ–°å¤šä¸ªå­—æ®µï¼ˆåªæ›´æ–°éé›¶å€¼å­—æ®µï¼‰
user.Name = "æ–°åå­—"
user.Age = 26
db.Save(&user)

// ä½¿ç”¨Updatesï¼ˆåªæ›´æ–°éé›¶å€¼å­—æ®µï¼‰
db.Model(&user).Updates(User{
    Name: "æ–°åå­—",
    Age:  26,
})

// ä½¿ç”¨mapæ›´æ–°ï¼ˆå¯ä»¥æ›´æ–°é›¶å€¼ï¼‰
db.Model(&user).Updates(map[string]interface{}{
    "name": "æ–°åå­—",
    "age":  0,  // é›¶å€¼ä¹Ÿä¼šæ›´æ–°
})
```

### 3.3 æ‰¹é‡æ›´æ–°

```go
// æ›´æ–°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
db.Model(&User{}).Where("age < ?", 18).Update("status", "minor")

// æ‰¹é‡æ›´æ–°å¤šä¸ªå­—æ®µ
db.Model(&User{}).Where("age < ?", 18).Updates(map[string]interface{}{
    "status": "minor",
    "age":    18,
})
```

### 3.4 æ›´æ–°æŒ‡å®šå­—æ®µ

```go
var user User
db.First(&user, 1)

// åªæ›´æ–°æŒ‡å®šå­—æ®µ
db.Model(&user).Select("name").Updates(map[string]interface{}{
    "name": "æ–°åå­—",
    "age":  26,  // è¿™ä¸ªå­—æ®µä¸ä¼šè¢«æ›´æ–°
})

// æ’é™¤æŒ‡å®šå­—æ®µ
db.Model(&user).Omit("age").Updates(map[string]interface{}{
    "name": "æ–°åå­—",
    "age":  26,  // è¿™ä¸ªå­—æ®µä¸ä¼šè¢«æ›´æ–°
})
```

### 3.5 è¡¨è¾¾å¼æ›´æ–°

```go
// ä½¿ç”¨SQLè¡¨è¾¾å¼æ›´æ–°
db.Model(&User{}).Where("id = ?", 1).Update("age", gorm.Expr("age + ?", 1))

// ä½¿ç”¨è¡¨è¾¾å¼æ›´æ–°å¤šä¸ªå­—æ®µ
db.Model(&User{}).Where("id = ?", 1).Updates(map[string]interface{}{
    "age": gorm.Expr("age + ?", 1),
})
```

---

## å››ã€åˆ é™¤ï¼ˆDeleteï¼‰

### 4.1 ç¡¬åˆ é™¤

```go
var user User

// åˆ é™¤å•ä¸ªè®°å½•
db.Delete(&user, 1)  // åˆ é™¤IDä¸º1çš„è®°å½•

// åˆ é™¤æŒ‡å®šæ¡ä»¶çš„è®°å½•
db.Where("age < ?", 18).Delete(&User{})

// æ‰¹é‡åˆ é™¤
db.Where("status = ?", "inactive").Delete(&User{})
```

### 4.2 è½¯åˆ é™¤

å¦‚æœæ¨¡å‹åŒ…å«`gorm.DeletedAt`å­—æ®µï¼ŒGORMä¼šè‡ªåŠ¨å¯ç”¨è½¯åˆ é™¤ï¼š

```go
type User struct {
    ID        uint           `gorm:"primaryKey"`
    Name      string
    DeletedAt gorm.DeletedAt `gorm:"index"`  // è½¯åˆ é™¤å­—æ®µ
}

// è½¯åˆ é™¤ï¼ˆä¸ä¼šçœŸæ­£åˆ é™¤ï¼Œåªæ˜¯è®¾ç½®DeletedAtï¼‰
var user User
db.First(&user, 1)
db.Delete(&user)  // è½¯åˆ é™¤

// æŸ¥è¯¢æ—¶è‡ªåŠ¨æ’é™¤è½¯åˆ é™¤çš„è®°å½•
var users []User
db.Find(&users)  // ä¸ä¼šåŒ…å«å·²è½¯åˆ é™¤çš„è®°å½•

// æŸ¥è¯¢åŒ…å«è½¯åˆ é™¤çš„è®°å½•
db.Unscoped().Find(&users)

// æ°¸ä¹…åˆ é™¤ï¼ˆç¡¬åˆ é™¤ï¼‰
db.Unscoped().Delete(&user)
```

### 4.3 åˆ é™¤ç›¸å…³è®°å½•

```go
// åˆ é™¤å…³è”è®°å½•
db.Select("Orders").Delete(&user)  // åˆ é™¤ç”¨æˆ·åŠå…¶è®¢å•

// åˆ é™¤æ‰€æœ‰å…³è”
db.Select(clause.Associations).Delete(&user)
```

---

## äº”ã€æ‰¹é‡æ“ä½œ

### 5.1 æ‰¹é‡åˆ›å»º

```go
users := []User{
    {Name: "ç”¨æˆ·1", Email: "user1@example.com"},
    {Name: "ç”¨æˆ·2", Email: "user2@example.com"},
    {Name: "ç”¨æˆ·3", Email: "user3@example.com"},
    // ... æ›´å¤šç”¨æˆ·
}

// æ‰¹é‡åˆ›å»º
db.Create(&users)

// åˆ†æ‰¹åˆ›å»ºï¼ˆæ¯æ‰¹100æ¡ï¼‰
db.CreateInBatches(users, 100)
```

### 5.2 æ‰¹é‡æ›´æ–°

```go
// æ›´æ–°æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
db.Model(&User{}).Where("age < ?", 18).Update("status", "minor")

// æ‰¹é‡æ›´æ–°å¤šä¸ªå­—æ®µ
db.Model(&User{}).Where("age < ?", 18).Updates(map[string]interface{}{
    "status": "active",
    "age":    18,
})
```

### 5.3 æ‰¹é‡åˆ é™¤

```go
// åˆ é™¤æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•
db.Where("status = ?", "inactive").Delete(&User{})

// åˆ é™¤æŒ‡å®šIDçš„è®°å½•
db.Delete(&User{}, []int{1, 2, 3})
```

---

## å…­ã€é”™è¯¯å¤„ç†

### 6.1 æ£€æŸ¥é”™è¯¯

```go
import (
    "errors"
    "gorm.io/gorm"
)

var user User

// æ£€æŸ¥è®°å½•ä¸å­˜åœ¨é”™è¯¯
result := db.First(&user, 999)
if errors.Is(result.Error, gorm.ErrRecordNotFound) {
    fmt.Println("è®°å½•ä¸å­˜åœ¨")
} else if result.Error != nil {
    fmt.Printf("æŸ¥è¯¢å¤±è´¥: %v\n", result.Error)
}

// æ£€æŸ¥å…¶ä»–é”™è¯¯
result = db.Create(&user)
if result.Error != nil {
    fmt.Printf("åˆ›å»ºå¤±è´¥: %v\n", result.Error)
}
```

### 6.2 å¸¸è§é”™è¯¯

```go
// å”¯ä¸€çº¦æŸå†²çª
result := db.Create(&User{Email: "existing@example.com"})
if result.Error != nil {
    if errors.Is(result.Error, gorm.ErrDuplicatedKey) {
        fmt.Println("é‚®ç®±å·²å­˜åœ¨")
    }
}

// å¤–é”®çº¦æŸé”™è¯¯
result = db.Delete(&User{}, 1)
if result.Error != nil {
    fmt.Printf("åˆ é™¤å¤±è´¥: %v\n", result.Error)
}
```

---

## ä¸ƒã€å®Œæ•´ç¤ºä¾‹

### 7.1 ç”¨æˆ·ç®¡ç†ç³»ç»ŸCRUD

```go
package main

import (
    "fmt"
    "log"

    "gorm.io/driver/sqlite"
    "gorm.io/gorm"
)

type User struct {
    ID    uint   `gorm:"primaryKey"`
    Name  string
    Email string `gorm:"uniqueIndex"`
    Age   int
}

func main() {
    db, err := gorm.Open(sqlite.Open("users.db"), &gorm.Config{})
    if err != nil {
        log.Fatal(err)
    }

    db.AutoMigrate(&User{})

    fmt.Println("=== åˆ›å»ºç”¨æˆ· ===")
    // åˆ›å»ºç”¨æˆ·
    user1 := User{Name: "å¼ ä¸‰", Email: "zhangsan@example.com", Age: 25}
    db.Create(&user1)
    fmt.Printf("åˆ›å»º: %+v\n", user1)

    user2 := User{Name: "æå››", Email: "lisi@example.com", Age: 30}
    db.Create(&user2)
    fmt.Printf("åˆ›å»º: %+v\n", user2)

    fmt.Println("\n=== æŸ¥è¯¢ç”¨æˆ· ===")
    // æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ·
    var users []User
    db.Find(&users)
    for _, u := range users {
        fmt.Printf("ç”¨æˆ·: %+v\n", u)
    }

    // æŸ¥è¯¢å•ä¸ªç”¨æˆ·
    var user User
    db.First(&user, "email = ?", "zhangsan@example.com")
    fmt.Printf("æ‰¾åˆ°: %+v\n", user)

    fmt.Println("\n=== æ›´æ–°ç”¨æˆ· ===")
    // æ›´æ–°ç”¨æˆ·
    db.Model(&user).Update("Age", 26)
    fmt.Printf("æ›´æ–°å: %+v\n", user)

    fmt.Println("\n=== åˆ é™¤ç”¨æˆ· ===")
    // åˆ é™¤ç”¨æˆ·
    db.Delete(&user2)
    fmt.Println("ç”¨æˆ·å·²åˆ é™¤")

    // å†æ¬¡æŸ¥è¯¢
    db.Find(&users)
    fmt.Printf("\nå‰©ä½™ç”¨æˆ·æ•°: %d\n", len(users))
}
```

---

## æ€»ç»“

### CRUDæ“ä½œè¦ç‚¹

1. **åˆ›å»ºï¼ˆCreateï¼‰**ï¼š
   - ä½¿ç”¨`Create`åˆ›å»ºå•ä¸ªæˆ–æ‰¹é‡è®°å½•
   - ä½¿ç”¨`Select`å’Œ`Omit`æ§åˆ¶åˆ›å»ºå­—æ®µ
   - ä½¿ç”¨`CreateInBatches`åˆ†æ‰¹åˆ›å»º

2. **æŸ¥è¯¢ï¼ˆReadï¼‰**ï¼š
   - `First`ã€`Take`ã€`Last`æŸ¥è¯¢å•æ¡è®°å½•
   - `Find`æŸ¥è¯¢å¤šæ¡è®°å½•
   - `Where`æ·»åŠ æŸ¥è¯¢æ¡ä»¶
   - `Order`ã€`Limit`ã€`Offset`æ§åˆ¶æ’åºå’Œåˆ†é¡µ

3. **æ›´æ–°ï¼ˆUpdateï¼‰**ï¼š
   - `Update`æ›´æ–°å•ä¸ªå­—æ®µ
   - `Updates`æ›´æ–°å¤šä¸ªå­—æ®µ
   - `Save`ä¿å­˜æ•´ä¸ªæ¨¡å‹
   - ä½¿ç”¨`Select`å’Œ`Omit`æ§åˆ¶æ›´æ–°å­—æ®µ

4. **åˆ é™¤ï¼ˆDeleteï¼‰**ï¼š
   - `Delete`è¿›è¡Œç¡¬åˆ é™¤æˆ–è½¯åˆ é™¤
   - è½¯åˆ é™¤éœ€è¦`gorm.DeletedAt`å­—æ®µ
   - ä½¿ç”¨`Unscoped`æ°¸ä¹…åˆ é™¤

### æœ€ä½³å®è·µ

1. **é”™è¯¯å¤„ç†**ï¼šå§‹ç»ˆæ£€æŸ¥æ“ä½œç»“æœ
2. **æ‰¹é‡æ“ä½œ**ï¼šå¤§é‡æ•°æ®ä½¿ç”¨æ‰¹é‡æ“ä½œ
3. **è½¯åˆ é™¤**ï¼šé‡è¦æ•°æ®ä½¿ç”¨è½¯åˆ é™¤
4. **å­—æ®µæ§åˆ¶**ï¼šä½¿ç”¨`Select`å’Œ`Omit`ç²¾ç¡®æ§åˆ¶æ“ä½œå­—æ®µ

æŒæ¡CRUDæ“ä½œæ˜¯ä½¿ç”¨GORMçš„åŸºç¡€ã€‚åœ¨ä¸‹ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ æ›´å¤æ‚çš„æŸ¥è¯¢å’Œæ¡ä»¶æ“ä½œã€‚