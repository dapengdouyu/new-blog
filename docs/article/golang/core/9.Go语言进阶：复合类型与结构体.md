---
title: 9ã€Goè¯­è¨€è¿›é˜¶ï¼šå¤åˆç±»å‹ä¸ç»“æ„ä½“
date: 2026-01-06
description: æ·±å…¥ç†è§£Goè¯­è¨€çš„ç»“æ„ä½“ã€Mapé›†åˆå’Œmakeå‡½æ•°çš„ä½¿ç”¨
---

# 8ã€Goè¯­è¨€è¿›é˜¶ï¼šå¤åˆç±»å‹ä¸ç»“æ„ä½“

æœ¬æ–‡æ¡£æ·±å…¥è®²è§£Goè¯­è¨€çš„å¤åˆæ•°æ®ç±»å‹ï¼šç»“æ„ä½“ã€Mapå’Œmakeå‡½æ•°çš„ä½¿ç”¨ã€‚

## ğŸ¯ æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… ç†è§£ç»“æ„ä½“çš„å®šä¹‰å’Œæ–¹æ³•
- âœ… æŒæ¡Mapï¼ˆæ˜ å°„ï¼‰çš„ä½¿ç”¨
- âœ… æŒæ¡makeå‡½æ•°çš„ä½¿ç”¨
- âœ… ç†è§£ç»“æ„ä½“åµŒå…¥å’Œæ–¹æ³•é›†
- âœ… ç†è§£å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„åŒºåˆ«

---

## ä¸€ã€ç»“æ„ä½“ï¼ˆStructï¼‰

### 1.1 ä»€ä¹ˆæ˜¯ç»“æ„ä½“ï¼Ÿ

ç»“æ„ä½“æ˜¯Goè¯­è¨€ä¸­ç”¨äºç»„ç»‡å¤šä¸ªç›¸å…³æ•°æ®å­—æ®µçš„å¤åˆç±»å‹ï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„ç±»ï¼ˆä½†æ²¡æœ‰ç»§æ‰¿ï¼‰ã€‚

#### åŸºæœ¬å®šä¹‰

```go
package main

import "fmt"

// å®šä¹‰ç»“æ„ä½“
type Person struct {
    Name string
    Age  int
    City string
}

func main() {
    // åˆ›å»ºç»“æ„ä½“å®ä¾‹
    p1 := Person{
        Name: "Alice",
        Age:  30,
        City: "Beijing",
    }
    
    // è®¿é—®å­—æ®µ
    fmt.Println(p1.Name)  // Alice
    fmt.Println(p1.Age)   // 30
}
```

#### ç»“æ„ä½“çš„é›¶å€¼

æœªåˆå§‹åŒ–çš„ç»“æ„ä½“å­—æ®µä¼šä½¿ç”¨å¯¹åº”ç±»å‹çš„é›¶å€¼ï¼š

```go
var p Person
fmt.Println(p.Name)  // ""ï¼ˆç©ºå­—ç¬¦ä¸²ï¼‰
fmt.Println(p.Age)   // 0
fmt.Println(p.City)  // ""
```

### 1.2 ç»“æ„ä½“çš„åˆ›å»ºæ–¹å¼

#### æ–¹å¼1ï¼šå­—é¢é‡åˆå§‹åŒ–

```go
// æŒ‡å®šå­—æ®µåï¼ˆæ¨èï¼‰
p1 := Person{
    Name: "Bob",
    Age:  25,
    City: "Shanghai",
}

// æŒ‰é¡ºåºåˆå§‹åŒ–ï¼ˆå¿…é¡»åŒ…å«æ‰€æœ‰å­—æ®µï¼‰
p2 := Person{"Charlie", 28, "Guangzhou"}

// éƒ¨åˆ†åˆå§‹åŒ–
p3 := Person{
    Name: "David",
    // Ageå’ŒCityä½¿ç”¨é›¶å€¼
}
```

#### æ–¹å¼2ï¼šä½¿ç”¨newå‡½æ•°

```go
p := new(Person)  // è¿”å›æŒ‡å‘Personçš„æŒ‡é’ˆ
p.Name = "Eve"
p.Age = 32
```

#### æ–¹å¼3ï¼šä½¿ç”¨å–å€ç¬¦

```go
p := &Person{
    Name: "Frank",
    Age:  35,
}
```

### 1.3 ç»“æ„ä½“æ–¹æ³•

Goè¯­è¨€é€šè¿‡**æ¥æ”¶è€…ï¼ˆReceiverï¼‰**ä¸ºç»“æ„ä½“æ·»åŠ æ–¹æ³•ï¼š

```go
package main

import "fmt"

type Rectangle struct {
    Width  float64
    Height float64
}

// å€¼æ¥æ”¶è€…æ–¹æ³•
func (r Rectangle) Area() float64 {
    return r.Width * r.Height
}

// æŒ‡é’ˆæ¥æ”¶è€…æ–¹æ³•
func (r *Rectangle) Scale(factor float64) {
    r.Width *= factor
    r.Height *= factor
}

func main() {
    rect := Rectangle{Width: 10, Height: 5}
    fmt.Println(rect.Area())  // 50
    
    rect.Scale(2)
    fmt.Println(rect.Width)   // 20
    fmt.Println(rect.Height)  // 10
}
```

#### å€¼æ¥æ”¶è€… vs æŒ‡é’ˆæ¥æ”¶è€…

| ç‰¹æ€§ | å€¼æ¥æ”¶è€… | æŒ‡é’ˆæ¥æ”¶è€… |
|------|---------|-----------|
| **ä¿®æ”¹åŸå€¼** | âŒ ä¸èƒ½ | âœ… å¯ä»¥ |
| **æ€§èƒ½** | å¤åˆ¶æ•´ä¸ªç»“æ„ä½“ | åªå¤åˆ¶æŒ‡é’ˆ |
| **ä½¿ç”¨åœºæ™¯** | ä¸ä¿®æ”¹ç»“æ„ä½“çš„æ–¹æ³• | éœ€è¦ä¿®æ”¹ç»“æ„ä½“çš„æ–¹æ³• |

```go
type Point struct {
    X, Y int
}

// å€¼æ¥æ”¶è€…ï¼šä¸ä¿®æ”¹åŸå€¼
func (p Point) Move(x, y int) Point {
    return Point{p.X + x, p.Y + y}
}

// æŒ‡é’ˆæ¥æ”¶è€…ï¼šä¿®æ”¹åŸå€¼
func (p *Point) MoveInPlace(x, y int) {
    p.X += x
    p.Y += y
}
```

### 1.4 ç»“æ„ä½“åµŒå…¥ï¼ˆEmbeddingï¼‰

Goè¯­è¨€é€šè¿‡åµŒå…¥å®ç°ç±»ä¼¼ç»§æ‰¿çš„æ•ˆæœï¼š

```go
package main

import "fmt"

// åŸºç¡€ç»“æ„ä½“
type Animal struct {
    Name string
}

func (a Animal) Speak() {
    fmt.Println(a.Name, "makes a sound")
}

// åµŒå…¥Animal
type Dog struct {
    Animal  // åµŒå…¥ï¼Œä¸æ˜¯ç»§æ‰¿
    Breed   string
}

// é‡å†™æ–¹æ³•
func (d Dog) Speak() {
    fmt.Println(d.Name, "barks")
}

func main() {
    dog := Dog{
        Animal: Animal{Name: "Buddy"},
        Breed:  "Golden Retriever",
    }
    
    dog.Speak()           // Buddy barks
    dog.Animal.Speak()    // Buddy makes a soundï¼ˆè°ƒç”¨åµŒå…¥çš„æ–¹æ³•ï¼‰
}
```

### 1.5 ç»“æ„ä½“æ ‡ç­¾ï¼ˆTagsï¼‰

ç»“æ„ä½“æ ‡ç­¾ç”¨äºå…ƒæ•°æ®ï¼Œå¸¸ç”¨äºJSONåºåˆ—åŒ–ã€æ•°æ®åº“æ˜ å°„ç­‰ï¼š

```go
package main

import (
    "encoding/json"
    "fmt"
)

type User struct {
    ID       int    `json:"id" db:"user_id"`
    Username string `json:"username" db:"username"`
    Email    string `json:"email,omitempty" db:"email"`  // omitempty: ç©ºå€¼æ—¶ä¸åºåˆ—åŒ–
    Password string `json:"-" db:"password"`              // -: ä¸åºåˆ—åŒ–
}

func main() {
    user := User{
        ID:       1,
        Username: "alice",
        Email:    "alice@example.com",
        Password: "secret",
    }
    
    data, _ := json.Marshal(user)
    fmt.Println(string(data))
    // è¾“å‡º: {"id":1,"username":"alice","email":"alice@example.com"}
}
```

---

## äºŒã€Mapï¼ˆæ˜ å°„ï¼‰

### 2.1 ä»€ä¹ˆæ˜¯Mapï¼Ÿ

Mapæ˜¯Goè¯­è¨€ä¸­çš„é”®å€¼å¯¹é›†åˆï¼Œç±»ä¼¼äºå…¶ä»–è¯­è¨€ä¸­çš„å­—å…¸ï¼ˆDictionaryï¼‰æˆ–å“ˆå¸Œè¡¨ï¼ˆHash Tableï¼‰ã€‚

#### åŸºæœ¬ä½¿ç”¨

```go
package main

import "fmt"

func main() {
    // å£°æ˜å¹¶åˆå§‹åŒ–
    scores := map[string]int{
        "Alice": 95,
        "Bob":   87,
        "Charlie": 92,
    }
    
    // è®¿é—®å…ƒç´ 
    fmt.Println(scores["Alice"])  // 95
    
    // ä¿®æ”¹å…ƒç´ 
    scores["Bob"] = 90
    
    // æ·»åŠ å…ƒç´ 
    scores["David"] = 88
    
    // åˆ é™¤å…ƒç´ 
    delete(scores, "Charlie")
}
```

### 2.2 Mapçš„åˆ›å»ºæ–¹å¼

#### æ–¹å¼1ï¼šå­—é¢é‡åˆå§‹åŒ–

```go
m1 := map[string]int{
    "a": 1,
    "b": 2,
}
```

#### æ–¹å¼2ï¼šä½¿ç”¨makeå‡½æ•°

```go
m2 := make(map[string]int)        // ç©ºmap
m3 := make(map[string]int, 10)     // é¢„åˆ†é…å®¹é‡ï¼ˆæç¤ºï¼Œéé™åˆ¶ï¼‰
```

#### æ–¹å¼3ï¼šé›¶å€¼map

```go
var m map[string]int  // nil mapï¼Œä¸èƒ½ç›´æ¥ä½¿ç”¨
// m["key"] = 1      // é”™è¯¯ï¼španic: assignment to entry in nil map

// å¿…é¡»å…ˆåˆå§‹åŒ–
m = make(map[string]int)
m["key"] = 1  // æ­£ç¡®
```

### 2.3 Mapçš„ç‰¹æ€§

#### 1. é›¶å€¼

è®¿é—®ä¸å­˜åœ¨çš„é”®ä¼šè¿”å›å€¼ç±»å‹çš„é›¶å€¼ï¼š

```go
m := map[string]int{}
fmt.Println(m["nonexistent"])  // 0ï¼ˆintçš„é›¶å€¼ï¼‰

// ä½†æ— æ³•åŒºåˆ†"é”®ä¸å­˜åœ¨"å’Œ"å€¼ä¸º0"
```

#### 2. æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨

ä½¿ç”¨ä¸¤ä¸ªè¿”å›å€¼æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨ï¼š

```go
m := map[string]int{
    "a": 0,
    "b": 1,
}

value, exists := m["a"]
if exists {
    fmt.Println("é”®å­˜åœ¨ï¼Œå€¼ä¸º:", value)
}

// æˆ–è€…ä½¿ç”¨ç®€å†™
if value, ok := m["c"]; ok {
    fmt.Println("é”®å­˜åœ¨:", value)
} else {
    fmt.Println("é”®ä¸å­˜åœ¨")
}
```

#### 3. éå†Map

```go
m := map[string]int{
    "apple":  5,
    "banana": 3,
    "cherry": 8,
}

// éå†é”®å€¼å¯¹
for key, value := range m {
    fmt.Println(key, value)
}

// åªéå†é”®
for key := range m {
    fmt.Println(key)
}

// åªéå†å€¼
for _, value := range m {
    fmt.Println(value)
}
```

**æ³¨æ„**ï¼šMapçš„éå†é¡ºåºæ˜¯**éšæœºçš„**ï¼Œä¸ä¿è¯é¡ºåºã€‚

### 2.4 Mapçš„åº•å±‚åŸç†

- Mapåº•å±‚ä½¿ç”¨**å“ˆå¸Œè¡¨**å®ç°
- é”®å¿…é¡»æ˜¯**å¯æ¯”è¾ƒç±»å‹**ï¼ˆä¸èƒ½æ˜¯sliceã€mapã€functionï¼‰
- Mapæ˜¯**å¼•ç”¨ç±»å‹**ï¼Œèµ‹å€¼æ—¶ä¼ é€’çš„æ˜¯å¼•ç”¨

```go
m1 := map[string]int{"a": 1}
m2 := m1          // m2å’Œm1æŒ‡å‘åŒä¸€ä¸ªmap
m2["b"] = 2
fmt.Println(m1)  // map[a:1 b:2]
```

### 2.5 Mapçš„æœ€ä½³å®è·µ

```go
// âœ… é¢„åˆ†é…å®¹é‡ï¼ˆå¦‚æœçŸ¥é“å¤§æ¦‚å¤§å°ï¼‰
m := make(map[string]int, 100)

// âœ… æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
if value, ok := m["key"]; ok {
    // ä½¿ç”¨value
}

// âœ… ä½¿ç”¨mapä½œä¸ºé›†åˆï¼ˆå€¼ç±»å‹ç”¨boolæˆ–struct{}ï¼‰
set := make(map[string]bool)
set["item1"] = true

// æ›´èŠ‚çœå†…å­˜çš„æ–¹å¼
set2 := make(map[string]struct{})
set2["item1"] = struct{}{}

// âŒ ä¸è¦å¯¹nil mapèµ‹å€¼
var m map[string]int
// m["key"] = 1  // panic
```

---

## ä¸‰ã€makeå‡½æ•°è¯¦è§£

### 3.1 ä»€ä¹ˆæ˜¯makeï¼Ÿ

`make` æ˜¯Goè¯­è¨€çš„å†…ç½®å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå¹¶åˆå§‹åŒ–**åˆ‡ç‰‡ï¼ˆsliceï¼‰**ã€**æ˜ å°„ï¼ˆmapï¼‰**å’Œ**é€šé“ï¼ˆchannelï¼‰**ã€‚è¿™äº›ç±»å‹éƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œéœ€è¦åˆå§‹åŒ–åæ‰èƒ½ä½¿ç”¨ã€‚

#### make vs new

| å‡½æ•° | ç”¨é€” | è¿”å›å€¼ | é€‚ç”¨ç±»å‹ |
|------|------|--------|----------|
| **make** | åˆ›å»ºå¹¶åˆå§‹åŒ–sliceã€mapã€channel | ç±»å‹æœ¬èº«ï¼ˆéæŒ‡é’ˆï¼‰ | sliceã€mapã€channel |
| **new** | åˆ†é…å†…å­˜å¹¶è¿”å›æŒ‡é’ˆ | æŒ‡å‘ç±»å‹çš„æŒ‡é’ˆ | æ‰€æœ‰ç±»å‹ |

```go
// makeï¼šè¿”å›åˆå§‹åŒ–åçš„ç±»å‹
s := make([]int, 5)        // []intï¼Œé•¿åº¦ä¸º5
m := make(map[string]int)  // map[string]intï¼Œå·²åˆå§‹åŒ–

// newï¼šè¿”å›æŒ‡å‘é›¶å€¼çš„æŒ‡é’ˆ
p := new(int)              // *intï¼Œå€¼ä¸º0
s2 := new([]int)           // *[]intï¼Œå€¼ä¸ºnilï¼ˆä¸æ¨èï¼‰
```

### 3.2 makeçš„è¯­æ³•

```go
// åŸºæœ¬è¯­æ³•
make(T, args...)

// T: ç±»å‹ï¼ˆsliceã€mapæˆ–channelï¼‰
// args: æ ¹æ®ç±»å‹ä¸åŒï¼Œå‚æ•°ä¹Ÿä¸åŒ
```

### 3.3 åˆ›å»ºåˆ‡ç‰‡ï¼ˆSliceï¼‰

#### åŸºæœ¬ç”¨æ³•

```go
package main

import "fmt"

func main() {
    // 1. åªæŒ‡å®šé•¿åº¦
    s1 := make([]int, 5)        // é•¿åº¦5ï¼Œå®¹é‡5ï¼Œå€¼å…¨ä¸º0
    fmt.Println(s1)              // [0 0 0 0 0]
    fmt.Println(len(s1), cap(s1)) // 5 5
    
    // 2. æŒ‡å®šé•¿åº¦å’Œå®¹é‡
    s2 := make([]int, 3, 10)    // é•¿åº¦3ï¼Œå®¹é‡10
    fmt.Println(s2)              // [0 0 0]
    fmt.Println(len(s2), cap(s2)) // 3 10
    
    // 3. å®¹é‡å¿…é¡» >= é•¿åº¦
    // s3 := make([]int, 5, 3)  // ç¼–è¯‘é”™è¯¯ï¼šlen larger than cap
}
```

#### é•¿åº¦ vs å®¹é‡

- **é•¿åº¦ï¼ˆlenï¼‰**ï¼šåˆ‡ç‰‡ä¸­å®é™…å…ƒç´ ä¸ªæ•°
- **å®¹é‡ï¼ˆcapï¼‰**ï¼šåº•å±‚æ•°ç»„å¯å®¹çº³çš„å…ƒç´ ä¸ªæ•°

```go
s := make([]int, 3, 10)
// é•¿åº¦3ï¼šå½“å‰æœ‰3ä¸ªå…ƒç´  [0, 0, 0]
// å®¹é‡10ï¼šåº•å±‚æ•°ç»„å¯ä»¥å®¹çº³10ä¸ªå…ƒç´ 

s = append(s, 1, 2, 3, 4, 5, 6, 7)
fmt.Println(len(s), cap(s))  // 10 10ï¼ˆå®¹é‡å·²æ»¡ï¼‰

s = append(s, 8)
fmt.Println(len(s), cap(s))  // 11 20ï¼ˆå®¹é‡è‡ªåŠ¨æ‰©å®¹ï¼‰
```

#### é¢„åˆ†é…å®¹é‡çš„ä¼˜åŠ¿

```go
// âŒ ä¸é¢„åˆ†é…ï¼šé¢‘ç¹æ‰©å®¹
var s []int
for i := 0; i < 1000; i++ {
    s = append(s, i)  // å¯èƒ½å¤šæ¬¡æ‰©å®¹
}

// âœ… é¢„åˆ†é…å®¹é‡ï¼šå‡å°‘æ‰©å®¹æ¬¡æ•°
s := make([]int, 0, 1000)  // é¢„åˆ†é…å®¹é‡
for i := 0; i < 1000; i++ {
    s = append(s, i)  // æ— éœ€æ‰©å®¹
}
```

### 3.4 åˆ›å»ºæ˜ å°„ï¼ˆMapï¼‰

#### åŸºæœ¬ç”¨æ³•

```go
package main

import "fmt"

func main() {
    // 1. ä¸æŒ‡å®šå®¹é‡
    m1 := make(map[string]int)
    m1["a"] = 1
    m1["b"] = 2
    
    // 2. æŒ‡å®šå®¹é‡ï¼ˆæç¤ºï¼Œéç¡¬æ€§é™åˆ¶ï¼‰
    m2 := make(map[string]int, 100)  // é¢„åˆ†é…å®¹é‡ï¼Œæé«˜æ€§èƒ½
    
    // 3. å®¹é‡ä¸º0æˆ–è´Ÿæ•°æ—¶ï¼Œä¼šè¢«å¿½ç•¥
    m3 := make(map[string]int, 0)     // ç­‰ä»·äº make(map[string]int)
}
```

#### å®¹é‡å‚æ•°çš„ä½œç”¨

mapçš„å®¹é‡å‚æ•°æ˜¯**æç¤ºæ€§çš„**ï¼Œä¸æ˜¯ç¡¬æ€§é™åˆ¶ï¼š

```go
m := make(map[string]int, 10)
// æç¤ºï¼šé¢„è®¡ä¼šå­˜å‚¨çº¦10ä¸ªé”®å€¼å¯¹
// å®é™…å¯ä»¥å­˜å‚¨æ›´å¤šï¼Œä½†é¢„åˆ†é…å¯ä»¥å‡å°‘æ‰©å®¹æ¬¡æ•°

// æ€§èƒ½å¯¹æ¯”
func benchmark() {
    // ä¸é¢„åˆ†é…
    m1 := make(map[string]int)
    for i := 0; i < 10000; i++ {
        m1[fmt.Sprintf("key%d", i)] = i
    }
    
    // é¢„åˆ†é…å®¹é‡
    m2 := make(map[string]int, 10000)
    for i := 0; i < 10000; i++ {
        m2[fmt.Sprintf("key%d", i)] = i
    }
    // m2çš„åˆ›å»ºå’Œæ’å…¥é€šå¸¸æ›´å¿«
}
```

### 3.5 åˆ›å»ºé€šé“ï¼ˆChannelï¼‰

é€šé“æ˜¯Goè¯­è¨€å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒï¼Œ`make` ç”¨äºåˆ›å»ºé€šé“ï¼š

```go
package main

import "fmt"

func main() {
    // 1. æ— ç¼“å†²é€šé“
    ch1 := make(chan int)
    // å‘é€å’Œæ¥æ”¶ä¼šé˜»å¡ï¼Œç›´åˆ°å¦ä¸€æ–¹å‡†å¤‡å¥½
    
    // 2. æœ‰ç¼“å†²é€šé“
    ch2 := make(chan int, 10)  // ç¼“å†²åŒºå¤§å°ä¸º10
    // ç¼“å†²åŒºæœªæ»¡æ—¶ï¼Œå‘é€ä¸ä¼šé˜»å¡
    // ç¼“å†²åŒºéç©ºæ—¶ï¼Œæ¥æ”¶ä¸ä¼šé˜»å¡
    
    // 3. åªå‘é€é€šé“
    ch3 := make(chan<- int)  // åªèƒ½å‘é€
    
    // 4. åªæ¥æ”¶é€šé“
    ch4 := make(<-chan int)  // åªèƒ½æ¥æ”¶
}
```

#### æ— ç¼“å†² vs æœ‰ç¼“å†²é€šé“

```go
// æ— ç¼“å†²é€šé“ï¼šåŒæ­¥é€šä¿¡
ch1 := make(chan int)
go func() {
    ch1 <- 1  // é˜»å¡ï¼Œç›´åˆ°æœ‰æ¥æ”¶è€…
}()
value := <-ch1  // æ¥æ”¶ï¼Œè§£é™¤å‘é€è€…çš„é˜»å¡

// æœ‰ç¼“å†²é€šé“ï¼šå¼‚æ­¥é€šä¿¡ï¼ˆåœ¨ç¼“å†²åŒºæœªæ»¡æ—¶ï¼‰
ch2 := make(chan int, 2)
ch2 <- 1  // ä¸é˜»å¡ï¼Œæ”¾å…¥ç¼“å†²åŒº
ch2 <- 2  // ä¸é˜»å¡ï¼Œæ”¾å…¥ç¼“å†²åŒº
ch2 <- 3  // é˜»å¡ï¼Œç¼“å†²åŒºå·²æ»¡
```

### 3.6 makeçš„åº•å±‚åŸç†

#### åˆ‡ç‰‡çš„å†…å­˜åˆ†é…

```go
s := make([]int, 3, 10)
// 1. åˆ†é…åº•å±‚æ•°ç»„ï¼ˆå®¹é‡10ï¼‰
// 2. åˆ›å»ºåˆ‡ç‰‡å¤´ï¼ˆåŒ…å«æŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡ï¼‰
// 3. åˆå§‹åŒ–å…ƒç´ ä¸ºé›¶å€¼
```

#### Mapçš„å†…å­˜åˆ†é…

```go
m := make(map[string]int, 100)
// 1. åˆ†é…å“ˆå¸Œè¡¨ç»“æ„
// 2. é¢„åˆ†é…æ¡¶ï¼ˆbucketï¼‰ç©ºé—´
// 3. åˆå§‹åŒ–å“ˆå¸Œè¡¨
```

#### é€šé“çš„å†…å­˜åˆ†é…

```go
ch := make(chan int, 10)
// 1. åˆ†é…é€šé“ç»“æ„
// 2. åˆ†é…ç¼“å†²åŒºï¼ˆå¦‚æœæœ‰ï¼‰
// 3. åˆå§‹åŒ–åŒæ­¥åŸè¯­
```

### 3.7 makeçš„å¸¸è§ç”¨æ³•æ¨¡å¼

#### 1. é¢„åˆ†é…åˆ‡ç‰‡å®¹é‡

```go
// åœºæ™¯ï¼šå·²çŸ¥å¤§æ¦‚å…ƒç´ æ•°é‡
func processItems(items []Item) {
    results := make([]Result, 0, len(items))  // é¢„åˆ†é…
    for _, item := range items {
        results = append(results, process(item))
    }
    return results
}
```

#### 2. åˆ›å»ºä¸´æ—¶åˆ‡ç‰‡

```go
// åœºæ™¯ï¼šéœ€è¦ä¸´æ—¶å­˜å‚¨æ•°æ®
func filter(numbers []int) []int {
    filtered := make([]int, 0)  // ç©ºåˆ‡ç‰‡
    for _, n := range numbers {
        if n > 0 {
            filtered = append(filtered, n)
        }
    }
    return filtered
}
```

#### 3. åˆå§‹åŒ–Map

```go
// åœºæ™¯ï¼šéœ€è¦å­˜å‚¨é”®å€¼å¯¹
func buildIndex(items []Item) map[string]Item {
    index := make(map[string]Item, len(items))  // é¢„åˆ†é…
    for _, item := range items {
        index[item.ID] = item
    }
    return index
}
```

#### 4. åˆ›å»ºé€šé“ç”¨äºgoroutineé€šä¿¡

```go
// åœºæ™¯ï¼šå¹¶å‘å¤„ç†
func processConcurrently(items []Item) []Result {
    ch := make(chan Result, len(items))  // æœ‰ç¼“å†²é€šé“
    
    // å¯åŠ¨å¤šä¸ªgoroutine
    for _, item := range items {
        go func(it Item) {
            ch <- process(it)
        }(item)
    }
    
    // æ”¶é›†ç»“æœ
    results := make([]Result, 0, len(items))
    for i := 0; i < len(items); i++ {
        results = append(results, <-ch)
    }
    return results
}
```

### 3.8 make vs å­—é¢é‡åˆå§‹åŒ–

#### åˆ‡ç‰‡

```go
// makeï¼šåˆ›å»ºæŒ‡å®šé•¿åº¦å’Œå®¹é‡çš„åˆ‡ç‰‡
s1 := make([]int, 5)        // [0 0 0 0 0]ï¼Œé•¿åº¦5ï¼Œå®¹é‡5

// å­—é¢é‡ï¼šåˆ›å»ºåŒ…å«åˆå§‹å€¼çš„åˆ‡ç‰‡
s2 := []int{1, 2, 3, 4, 5}   // [1 2 3 4 5]ï¼Œé•¿åº¦5ï¼Œå®¹é‡5

// ç©ºåˆ‡ç‰‡
s3 := make([]int, 0)         // []ï¼Œé•¿åº¦0ï¼Œå®¹é‡0
s4 := []int{}                // []ï¼Œé•¿åº¦0ï¼Œå®¹é‡0ï¼ˆå­—é¢é‡ï¼‰
```

#### Map

```go
// makeï¼šåˆ›å»ºç©ºmap
m1 := make(map[string]int)   // ç©ºmap

// å­—é¢é‡ï¼šåˆ›å»ºåŒ…å«åˆå§‹é”®å€¼å¯¹çš„map
m2 := map[string]int{
    "a": 1,
    "b": 2,
}

// nil mapï¼ˆä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼‰
var m3 map[string]int        // nilï¼Œéœ€è¦makeåæ‰èƒ½ä½¿ç”¨
```

### 3.9 makeçš„æœ€ä½³å®è·µ

```go
// âœ… é¢„åˆ†é…å®¹é‡ï¼ˆå¦‚æœçŸ¥é“å¤§æ¦‚å¤§å°ï¼‰
s := make([]int, 0, 1000)
m := make(map[string]int, 100)

// âœ… ä½¿ç”¨makeåˆå§‹åŒ–ï¼Œé¿å…nil
var s []int
s = make([]int, 0)  // æ˜ç¡®åˆå§‹åŒ–

// âœ… é€šé“å®¹é‡æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©
ch := make(chan int, 10)  // æœ‰ç¼“å†²ï¼Œé€‚åˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼

// âŒ ä¸è¦å¯¹nil slice/mapä½¿ç”¨make
var s []int
// s = make([]int)  // é”™è¯¯ï¼šå‚æ•°ä¸è¶³

// âŒ ä¸è¦è¿‡åº¦é¢„åˆ†é…
s := make([]int, 0, 1000000)  // å¦‚æœå®é™…åªç”¨100ä¸ªï¼Œæµªè´¹å†…å­˜
```

### 3.10 makeçš„å¸¸è§é”™è¯¯

#### é”™è¯¯1ï¼šæ··æ·†é•¿åº¦å’Œå®¹é‡

```go
// âŒ é”™è¯¯ç†è§£
s := make([]int, 10, 5)  // ç¼–è¯‘é”™è¯¯ï¼šlen larger than cap

// âœ… æ­£ç¡®
s := make([]int, 5, 10)  // é•¿åº¦5ï¼Œå®¹é‡10
```

#### é”™è¯¯2ï¼šå¯¹nil mapä½¿ç”¨make

```go
// âŒ ä¸å¿…è¦çš„make
var m map[string]int
m = make(map[string]int)  // æ­£ç¡®ï¼Œä½†å¯ä»¥ç®€åŒ–ä¸ºï¼š
m := make(map[string]int)  // âœ… æ›´ç®€æ´
```

#### é”™è¯¯3ï¼šmakeé€šé“æ—¶å®¹é‡ä¸º0

```go
// æ— ç¼“å†²é€šé“
ch1 := make(chan int)      // âœ… æ­£ç¡®
ch2 := make(chan int, 0)   // âœ… ç­‰ä»·äºch1

// æœ‰ç¼“å†²é€šé“
ch3 := make(chan int, 10)  // âœ… æ­£ç¡®
```

---

## å››ã€ç»¼åˆç¤ºä¾‹

```go
package main

import (
    "fmt"
    "errors"
)

// ç»“æ„ä½“å®šä¹‰
type User struct {
    ID    int
    Name  string
    Email string
}

// ç»“æ„ä½“æ–¹æ³•
func (u User) String() string {
    return fmt.Sprintf("User{ID: %d, Name: %s, Email: %s}", u.ID, u.Name, u.Email)
}

// Mapå­˜å‚¨ç”¨æˆ·
type UserStore struct {
    users map[int]*User
}

// æ„é€ å‡½æ•°
func NewUserStore() *UserStore {
    return &UserStore{
        users: make(map[int]*User),
    }
}

// æ·»åŠ ç”¨æˆ·
func (s *UserStore) AddUser(user *User) error {
    if user == nil {
        return errors.New("ç”¨æˆ·ä¸èƒ½ä¸ºç©º")
    }
    if _, exists := s.users[user.ID]; exists {
        return fmt.Errorf("ç”¨æˆ·ID %d å·²å­˜åœ¨", user.ID)
    }
    s.users[user.ID] = user
    return nil
}

// æŸ¥æ‰¾ç”¨æˆ·
func (s *UserStore) FindUser(id int) (*User, bool) {
    user, exists := s.users[id]
    return user, exists
}

// éå†æ‰€æœ‰ç”¨æˆ·
func (s *UserStore) ForEach(fn func(*User)) {
    for _, user := range s.users {
        fn(user)
    }
}

func main() {
    // åˆ›å»ºç”¨æˆ·å­˜å‚¨
    store := NewUserStore()
    
    // æ·»åŠ ç”¨æˆ·
    users := []*User{
        {ID: 1, Name: "Alice", Email: "alice@example.com"},
        {ID: 2, Name: "Bob", Email: "bob@example.com"},
        {ID: 3, Name: "Charlie", Email: "charlie@example.com"},
    }
    
    for _, user := range users {
        if err := store.AddUser(user); err != nil {
            fmt.Println("æ·»åŠ ç”¨æˆ·å¤±è´¥:", err)
        }
    }
    
    // æŸ¥æ‰¾ç”¨æˆ·
    if user, found := store.FindUser(2); found {
        fmt.Println("æ‰¾åˆ°ç”¨æˆ·:", user)
    }
    
    // éå†ç”¨æˆ·
    fmt.Println("\næ‰€æœ‰ç”¨æˆ·:")
    store.ForEach(func(u *User) {
        fmt.Println(u)
    })
    
    // æ¡ä»¶åˆ¤æ–­
    if count := len(store.users); count > 0 {
        fmt.Printf("\nå…±æœ‰ %d ä¸ªç”¨æˆ·\n", count)
    }
}
```

---

## æ€»ç»“

1. **ç»“æ„ä½“**ï¼šç»„ç»‡ç›¸å…³æ•°æ®ï¼Œé€šè¿‡æ–¹æ³•æ·»åŠ è¡Œä¸ºï¼Œæ”¯æŒåµŒå…¥å®ç°ç»„åˆ
2. **Map**ï¼šé”®å€¼å¯¹é›†åˆï¼Œä½¿ç”¨å“ˆå¸Œè¡¨å®ç°ï¼Œæ³¨æ„é›¶å€¼å’Œé”®å­˜åœ¨æ€§æ£€æŸ¥
3. **makeå‡½æ•°**ï¼šç”¨äºåˆ›å»ºå¹¶åˆå§‹åŒ–sliceã€mapå’Œchannelï¼Œç†è§£é•¿åº¦ä¸å®¹é‡çš„åŒºåˆ«ï¼Œåˆç†é¢„åˆ†é…å®¹é‡

æŒæ¡è¿™äº›æ ¸å¿ƒç‰¹æ€§ï¼Œæ˜¯ç¼–å†™é«˜è´¨é‡Goä»£ç çš„åŸºç¡€ã€‚åœ¨å®é™…å¼€å‘ä¸­ï¼Œè¦ç‰¹åˆ«æ³¨æ„ï¼š
- ç»“æ„ä½“çš„å€¼æ¥æ”¶è€…å’ŒæŒ‡é’ˆæ¥æ”¶è€…çš„é€‰æ‹©
- Mapçš„é›¶å€¼å¤„ç†å’Œé”®å­˜åœ¨æ€§æ£€æŸ¥
- makeå‡½æ•°çš„ä½¿ç”¨ï¼šåˆ‡ç‰‡é•¿åº¦ä¸å®¹é‡çš„åŒºåˆ«ï¼Œåˆç†é¢„åˆ†é…å®¹é‡ä»¥æé«˜æ€§èƒ½
