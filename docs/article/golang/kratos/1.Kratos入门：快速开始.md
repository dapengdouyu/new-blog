---
title: 1ã€Kratoså…¥é—¨ï¼šå¿«é€Ÿå¼€å§‹
date: 2026-01-06
description: Kratosæ¡†æ¶å¿«é€Ÿå…¥é—¨ï¼Œåˆ›å»ºç¬¬ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨
---

# 1ã€Kratoså…¥é—¨ï¼šå¿«é€Ÿå¼€å§‹

æœ¬æ–‡æ¡£å°†å¸¦ä½ å¿«é€Ÿä¸Šæ‰‹Kratosæ¡†æ¶ï¼Œåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªå¾®æœåŠ¡åº”ç”¨ã€‚

## ğŸ¯ æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… äº†è§£Kratosæ¡†æ¶çš„ç‰¹ç‚¹å’Œæ¶æ„
- âœ… å­¦ä¼šå®‰è£…å’Œé…ç½®Kratos
- âœ… åˆ›å»ºç¬¬ä¸€ä¸ªKratosåº”ç”¨
- âœ… æŒæ¡åŸºæœ¬çš„HTTPæœåŠ¡é…ç½®
- âœ… ç†è§£Kratosé¡¹ç›®ç»“æ„

---

## ä¸€ã€Kratosæ¡†æ¶ç®€ä»‹

### 1.1 ä»€ä¹ˆæ˜¯Kratosï¼Ÿ

Kratosæ˜¯bilibiliå¼€æºçš„Goå¾®æœåŠ¡æ¡†æ¶ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š

- **å¾®æœåŠ¡å‹å¥½**ï¼šä¸“ä¸ºå¾®æœåŠ¡æ¶æ„è®¾è®¡ï¼Œæ”¯æŒæœåŠ¡æ³¨å†Œå‘ç°ã€é…ç½®ä¸­å¿ƒç­‰
- **é«˜æ€§èƒ½**ï¼šåŸºäºgRPCå’ŒHTTP/2ï¼Œæä¾›é«˜æ€§èƒ½çš„æœåŠ¡é—´é€šä¿¡
- **äº‘åŸç”Ÿ**ï¼šæ”¯æŒKubernetesã€Dockerç­‰äº‘åŸç”ŸæŠ€æœ¯æ ˆ
- **ä¼ä¸šçº§**ï¼šæä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡æ²»ç†èƒ½åŠ›
- **æ˜“æ‰©å±•**ï¼šæ’ä»¶åŒ–çš„æ¶æ„ï¼Œæ˜“äºæ‰©å±•å’Œå®šåˆ¶
- **ç”Ÿäº§å°±ç»ª**ï¼šç»è¿‡bilibiliå¤§è§„æ¨¡ç”Ÿäº§ç¯å¢ƒéªŒè¯

### 1.2 Kratos vs å…¶ä»–æ¡†æ¶

| ç‰¹æ€§ | Kratos | Gin | Echo | Go-Zero |
|------|--------|-----|------|---------|
| **å®šä½** | å¾®æœåŠ¡æ¡†æ¶ | Webæ¡†æ¶ | Webæ¡†æ¶ | å¾®æœåŠ¡æ¡†æ¶ |
| **é€šä¿¡åè®®** | gRPC + HTTP | HTTP | HTTP | gRPC + HTTP |
| **æœåŠ¡æ²»ç†** | âœ… å®Œæ•´ | âŒ | âŒ | âœ… å®Œæ•´ |
| **ä»£ç ç”Ÿæˆ** | âœ… Protobuf | âŒ | âŒ | âœ… |
| **é…ç½®ä¸­å¿ƒ** | âœ… | âŒ | âŒ | âœ… |
| **æœåŠ¡å‘ç°** | âœ… | âŒ | âŒ | âœ… |
| **å­¦ä¹ æ›²çº¿** | ä¸­ç­‰ | ç®€å• | ç®€å• | ä¸­ç­‰ |

### 1.3 Kratosæ¶æ„ç»„ä»¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Kratos App               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Transport Layer (HTTP/gRPC)        â”‚
â”‚  â”œâ”€ HTTP Server                     â”‚
â”‚  â””â”€ gRPC Server                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer                      â”‚
â”‚  â”œâ”€ Business Logic                  â”‚
â”‚  â””â”€ Data Access                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Infrastructure Layer               â”‚
â”‚  â”œâ”€ Configuration                   â”‚
â”‚  â”œâ”€ Logging                         â”‚
â”‚  â”œâ”€ Metrics                         â”‚
â”‚  â”œâ”€ Tracing                         â”‚
â”‚  â””â”€ Registry                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€å®‰è£…Kratos

### 2.1 å®‰è£…Kratos CLIå·¥å…·

```bash
# æ–¹å¼1ï¼šä½¿ç”¨go installï¼ˆæ¨èï¼‰
go install github.com/go-kratos/kratos/cmd/kratos/v2@latest

# æ–¹å¼2ï¼šä¸‹è½½é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶
# ä» https://github.com/go-kratos/kratos/releases ä¸‹è½½

# æ–¹å¼3ï¼šä½¿ç”¨åŒ…ç®¡ç†å™¨
# macOS
brew install kratos

# éªŒè¯å®‰è£…
kratos -version
```

### 2.2 å®‰è£…ä¾èµ–

```bash
# å®‰è£…Protobufç¼–è¯‘å™¨
# macOS
brew install protobuf

# Ubuntu/Debian
sudo apt-get install protobuf-compiler

# å®‰è£…protoc-gen-goæ’ä»¶
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
go install github.com/go-kratos/kratos/cmd/protoc-gen-go-http/v2@latest
go install github.com/go-kratos/kratos/cmd/protoc-gen-go-errors/v2@latest
```

---

## ä¸‰ã€åˆ›å»ºç¬¬ä¸€ä¸ªKratosåº”ç”¨

### 3.1 ä½¿ç”¨Kratos CLIåˆ›å»ºé¡¹ç›®

```bash
# åˆ›å»ºæ–°é¡¹ç›®
kratos new helloworld

# è¿›å…¥é¡¹ç›®ç›®å½•
cd helloworld

# æŸ¥çœ‹é¡¹ç›®ç»“æ„
tree .
```

### 3.2 é¡¹ç›®ç»“æ„è§£æ

```
helloworld/
â”œâ”€â”€ api/                    # APIå®šä¹‰ï¼ˆProtobufï¼‰
â”‚   â””â”€â”€ helloworld/
â”‚       â””â”€â”€ v1/
â”‚           â””â”€â”€ greeter.proto
â”œâ”€â”€ cmd/                    # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ server/
â”‚       â”œâ”€â”€ main.go
â”‚       â”œâ”€â”€ wire.go         # ä¾èµ–æ³¨å…¥
â”‚       â””â”€â”€ wire_gen.go
â”œâ”€â”€ configs/                # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.yaml
â”œâ”€â”€ internal/               # ç§æœ‰ä»£ç 
â”‚   â”œâ”€â”€ biz/               # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â””â”€â”€ greeter.go
â”‚   â”œâ”€â”€ conf/              # é…ç½®å®šä¹‰
â”‚   â”‚   â””â”€â”€ conf.go
â”‚   â”œâ”€â”€ data/              # æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ data.go
â”‚   â”œâ”€â”€ server/            # æœåŠ¡å™¨å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ grpc.go
â”‚   â”‚   â”œâ”€â”€ http.go
â”‚   â”‚   â””â”€â”€ server.go
â”‚   â””â”€â”€ service/           # æœåŠ¡å®ç°
â”‚       â””â”€â”€ greeter.go
â”œâ”€â”€ third_party/           # ç¬¬ä¸‰æ–¹ä¾èµ–
â”‚   â”œâ”€â”€ google/
â”‚   â””â”€â”€ kratos/
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ Makefile
â””â”€â”€ README.md
```

### 3.3 è¿è¡Œåº”ç”¨

```bash
# å®‰è£…ä¾èµ–
go mod download

# è¿è¡Œåº”ç”¨
kratos run

# æˆ–è€…ä½¿ç”¨go run
go run cmd/server/main.go
```

### 3.4 æµ‹è¯•API

```bash
# HTTPè¯·æ±‚
curl "http://localhost:8000/helloworld/hi?name=kratos"

# å“åº”
{"message":"Hello kratos"}
```

---

## å››ã€ç†è§£Kratosåº”ç”¨ç»“æ„

### 4.1 APIå±‚ï¼ˆProtobufå®šä¹‰ï¼‰

**api/helloworld/v1/greeter.proto**:

```protobuf
syntax = "proto3";

package api.helloworld.v1;

import "google/api/annotations.proto";

option go_package = "github.com/go-kratos/kratos-layout/api/helloworld/v1;v1";

// The greeting service definition.
service Greeter {
  rpc SayHello (HelloRequest) returns (HelloReply) {
    option (google.api.http) = {
      get: "/helloworld/{name}",
    };
  }
}

// The request message containing the user's name.
message HelloRequest {
  string name = 1;
}

// The response message containing the greetings.
message HelloReply {
  string message = 1;
}
```

### 4.2 æœåŠ¡å±‚ï¼ˆServiceï¼‰

**internal/service/greeter.go**:

```go
package service

import (
    "context"
    v1 "github.com/go-kratos/kratos-layout/api/helloworld/v1"
    "github.com/go-kratos/kratos-layout/internal/biz"
)

type GreeterService struct {
    v1.UnimplementedGreeterServer

    uc *biz.GreeterUsecase
}

func NewGreeterService(uc *biz.GreeterUsecase) *GreeterService {
    return &GreeterService{uc: uc}
}

func (s *GreeterService) SayHello(ctx context.Context, req *v1.HelloRequest) (*v1.HelloReply, error) {
    return s.uc.SayHello(ctx, req)
}
```

### 4.3 ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBizï¼‰

**internal/biz/greeter.go**:

```go
package biz

import (
    "context"
    v1 "github.com/go-kratos/kratos-layout/api/helloworld/v1"
)

type GreeterUsecase struct {
    // å¯ä»¥æ³¨å…¥å…¶ä»–ä¾èµ–ï¼Œå¦‚repository
}

func NewGreeterUsecase() *GreeterUsecase {
    return &GreeterUsecase{}
}

func (uc *GreeterUsecase) SayHello(ctx context.Context, req *v1.HelloRequest) (*v1.HelloReply, error) {
    return &v1.HelloReply{
        Message: "Hello " + req.Name,
    }, nil
}
```

### 4.4 æ•°æ®è®¿é—®å±‚ï¼ˆDataï¼‰

**internal/data/data.go**:

```go
package data

import (
    "github.com/go-kratos/kratos/v2/log"
    "github.com/google/wire"
)

var ProviderSet = wire.NewSet(NewData, NewGreeterRepo)

type Data struct {
    // å¯ä»¥åŒ…å«æ•°æ®åº“è¿æ¥ç­‰
}

func NewData() (*Data, func(), error) {
    d := &Data{}
    return d, func() {
        // æ¸…ç†èµ„æº
        log.Info("closing the data resources")
    }, nil
}

type greeterRepo struct {
    data *Data
    log  *log.Helper
}

func NewGreeterRepo(data *Data, logger log.Logger) biz.GreeterRepo {
    return &greeterRepo{
        data: data,
        log:  log.NewHelper(logger),
    }
}
```

### 4.5 é…ç½®ç®¡ç†

**configs/config.yaml**:

```yaml
server:
  http:
    addr: 0.0.0.0:8000
  grpc:
    addr: 0.0.0.0:9000

data:
  database:
    driver: mysql
    source: root:password@tcp(localhost:3306)/kratos?charset=utf8mb4&parseTime=True&loc=Local
```

**internal/conf/conf.go**:

```go
package conf

import (
    "github.com/go-kratos/kratos/v2/config"
    "github.com/go-kratos/kratos/v2/config/file"
)

type Config struct {
    Server *Server `json:"server"`
    Data   *Data   `json:"data"`
}

type Server struct {
    Http *Http `json:"http"`
    Grpc *Grpc `json:"grpc"`
}

type Http struct {
    Addr string `json:"addr"`
}

type Grpc struct {
    Addr string `json:"addr"`
}

type Data struct {
    Database *Database `json:"database"`
}

type Database struct {
    Driver string `json:"driver"`
    Source string `json:"source"`
}

func LoadConfig() (*Config, error) {
    c := config.New(
        config.WithSource(
            file.NewSource("configs/config.yaml"),
        ),
    )
    defer c.Close()

    if err := c.Load(); err != nil {
        return nil, err
    }

    var bc Config
    if err := c.Scan(&bc); err != nil {
        return nil, err
    }

    return &bc, nil
}
```

---

## äº”ã€Kratosçš„æ ¸å¿ƒæ¦‚å¿µ

### 5.1 Wireä¾èµ–æ³¨å…¥

Kratosä½¿ç”¨Googleçš„Wireè¿›è¡Œä¾èµ–æ³¨å…¥ï¼š

**cmd/server/wire.go**:

```go
//go:build wireinject
// +build wireinject

package main

import (
    "github.com/go-kratos/kratos/v2"
    "github.com/go-kratos/kratos-layout/internal/biz"
    "github.com/go-kratos/kratos-layout/internal/conf"
    "github.com/go-kratos/kratos-layout/internal/data"
    "github.com/go-kratos/kratos-layout/internal/server"
    "github.com/go-kratos/kratos-layout/internal/service"
    "github.com/google/wire"
)

func initApp(*conf.Server, *conf.Data) (*kratos.App, func(), error) {
    panic(wire.Build(server.ProviderSet, data.ProviderSet, biz.ProviderSet, service.ProviderSet, newApp))
}
```

### 5.2 åº”ç”¨ç”Ÿå‘½å‘¨æœŸ

```go
func newApp(hs *server.HttpServer, gs *server.GrpcServer) *kratos.App {
    return kratos.New(
        kratos.ID(id),
        kratos.Name(Name),
        kratos.Version(Version),
        kratos.Metadata(map[string]string{}),
        kratos.Logger(logger),
        kratos.Server(
            hs,
            gs,
        ),
    )
}
```

---

## å…­ã€å¸¸ç”¨å‘½ä»¤

```bash
# åˆ›å»ºæ–°é¡¹ç›®
kratos new [project-name]

# è¿è¡Œåº”ç”¨
kratos run

# å‡çº§Kratosç‰ˆæœ¬
kratos upgrade

# ç”ŸæˆProtobufä»£ç 
kratos proto add api/[service]/[version]/[service].proto
kratos proto client api/[service]/[version]/[service].proto
kratos proto server api/[service]/[version]/[service].proto

# æ˜¾ç¤ºç‰ˆæœ¬
kratos version
```

---

## ä¸ƒã€è‡ªå®šä¹‰å¯åŠ¨

å¦‚æœä½ ä¸æƒ³ä½¿ç”¨Kratos CLIï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»ºé¡¹ç›®ï¼š

```go
package main

import (
    "log"
    "github.com/go-kratos/kratos/v2"
    "github.com/go-kratos/kratos/v2/transport/grpc"
    "github.com/go-kratos/kratos/v2/transport/http"
)

func main() {
    httpSrv := http.NewServer(
        http.Address(":8000"),
    )

    grpcSrv := grpc.NewServer(
        grpc.Address(":9000"),
    )

    app := kratos.New(
        kratos.Name("helloworld"),
        kratos.Server(
            httpSrv,
            grpcSrv,
        ),
    )

    if err := app.Run(); err != nil {
        log.Fatal(err)
    }
}
```

---

## æ€»ç»“

1. **Kratosæ¡†æ¶**ï¼šä¸“ä¸ºå¾®æœåŠ¡è®¾è®¡çš„Goæ¡†æ¶ï¼ŒåŠŸèƒ½ä¸°å¯Œ
2. **é¡¹ç›®åˆ›å»º**ï¼šä½¿ç”¨`kratos new`å‘½ä»¤å¿«é€Ÿåˆ›å»ºé¡¹ç›®
3. **æ¶æ„åˆ†å±‚**ï¼šæ¸…æ™°çš„APIã€Serviceã€Bizã€Dataåˆ†å±‚æ¶æ„
4. **ä¾èµ–æ³¨å…¥**ï¼šä½¿ç”¨Wireè¿›è¡Œä¾èµ–ç®¡ç†
5. **é…ç½®ç®¡ç†**ï¼šæ”¯æŒå¤šç§é…ç½®æºå’Œæ ¼å¼
6. **å¤šåè®®æ”¯æŒ**ï¼šåŒæ—¶æ”¯æŒHTTPå’ŒgRPC

**ä¸‹ä¸€æ­¥**ï¼šå­¦ä¹ [ç¬¬2è¯¾ï¼šHTTPæœåŠ¡](./2.KratosåŸºç¡€ï¼šHTTPæœåŠ¡.md)ï¼Œæ·±å…¥äº†è§£Kratosçš„HTTPæœåŠ¡å¼€å‘ã€‚

---

## ğŸ“š æ‰©å±•é˜…è¯»

- [Kratoså®˜æ–¹æ–‡æ¡£](https://go-kratos.dev/docs/getting-started/start/)
- [Protobufå…¥é—¨æŒ‡å—](https://developers.google.com/protocol-buffers/docs/overview)
- [Wireä¾èµ–æ³¨å…¥](https://github.com/google/wire)
