---
title: WebAssemblyå…¥é—¨ï¼šå¿«é€Ÿå¼€å§‹
date: 2026-01-15
description: äº†è§£WebAssemblyçš„åŸºæœ¬æ¦‚å¿µï¼Œå­¦ä¹ å¦‚ä½•ç¼–è¯‘Goä»£ç ä¸ºWebAssemblyå¹¶åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
---

# WebAssemblyå…¥é—¨ï¼šå¿«é€Ÿå¼€å§‹

## ä¸€ã€ä»€ä¹ˆæ˜¯WebAssembly

### 1.1 WebAssemblyç®€ä»‹

WebAssemblyï¼ˆç®€ç§°WASMï¼‰æ˜¯ä¸€ç§ä½çº§çš„äºŒè¿›åˆ¶æ ¼å¼ï¼Œå¯ä»¥åœ¨ç°ä»£Webæµè§ˆå™¨ä¸­è¿è¡Œã€‚å®ƒè¢«è®¾è®¡ä¸ºä¸€ç§å¯ç§»æ¤çš„ç¼–è¯‘ç›®æ ‡ï¼Œå…è®¸ç”¨å¤šç§ç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ä»£ç åœ¨Webä¸Šè¿è¡Œã€‚

### 1.2 WebAssemblyçš„ä¸»è¦ç‰¹ç‚¹

- **é«˜æ€§èƒ½**ï¼šæ¥è¿‘åŸç”Ÿä»£ç çš„æ‰§è¡Œé€Ÿåº¦
- **å¯ç§»æ¤**ï¼šè·¨å¹³å°è¿è¡Œï¼Œä¸ä¾èµ–ç‰¹å®šç¡¬ä»¶
- **å®‰å…¨**ï¼šè¿è¡Œåœ¨æ²™ç®±ç¯å¢ƒä¸­ï¼Œå®‰å…¨æ€§é«˜
- **ç´§å‡‘**ï¼šäºŒè¿›åˆ¶æ ¼å¼ï¼Œä½“ç§¯å°
- **å¯è°ƒè¯•**ï¼šæ”¯æŒSource Mapsï¼Œä¾¿äºè°ƒè¯•

### 1.3 WebAssembly vs JavaScript

| ç‰¹æ€§ | WebAssembly | JavaScript |
|------|-------------|------------|
| æ‰§è¡Œé€Ÿåº¦ | æ¥è¿‘åŸç”Ÿ | è§£é‡Šæ‰§è¡Œ |
| æ–‡ä»¶å¤§å° | äºŒè¿›åˆ¶ï¼Œè¾ƒå° | æ–‡æœ¬ï¼Œå¯èƒ½è¾ƒå¤§ |
| ç¼–è¯‘ | éœ€è¦ç¼–è¯‘ | ç›´æ¥è¿è¡Œ |
| é€‚ç”¨åœºæ™¯ | CPUå¯†é›†å‹ä»»åŠ¡ | é€šç”¨Webå¼€å‘ |
| å­¦ä¹ æ›²çº¿ | éœ€è¦å­¦ä¹ æ–°è¯­è¨€ | ç›¸å¯¹ç®€å• |

### 1.4 Goè¯­è¨€å¯¹WebAssemblyçš„æ”¯æŒ

Goè¯­è¨€ä»1.11ç‰ˆæœ¬å¼€å§‹æ”¯æŒç¼–è¯‘ä¸ºWebAssemblyã€‚Goæä¾›äº†`syscall/js`åŒ…ï¼Œç”¨äºä¸JavaScriptäº¤äº’ã€‚

## äºŒã€ç¯å¢ƒå‡†å¤‡

### 2.1 ç³»ç»Ÿè¦æ±‚

- **Goç‰ˆæœ¬**ï¼šGo 1.11æˆ–æ›´é«˜ç‰ˆæœ¬
- **æµè§ˆå™¨**ï¼šæ”¯æŒWebAssemblyçš„ç°ä»£æµè§ˆå™¨
  - Chrome 57+
  - Firefox 52+
  - Safari 11+
  - Edge 16+

### 2.2 æ£€æŸ¥Goç‰ˆæœ¬

```bash
go version
```

å¦‚æœç‰ˆæœ¬ä½äº1.11ï¼Œéœ€è¦å‡çº§Goã€‚

### 2.3 è®¾ç½®WebAssemblyç›®æ ‡

Goç¼–è¯‘WebAssemblyéœ€è¦è®¾ç½®ç¯å¢ƒå˜é‡ï¼š

```bash
# Linux/macOS
export GOOS=js
export GOARCH=wasm

# Windows (PowerShell)
$env:GOOS="js"
$env:GOARCH="wasm"
```

## ä¸‰ã€ç¬¬ä¸€ä¸ªWebAssemblyç¨‹åº

### 3.1 åˆ›å»ºGoç¨‹åº

åˆ›å»ºæ–‡ä»¶`main.go`ï¼š

```go
package main

import (
    "fmt"
    "syscall/js"
)

func main() {
    // åœ¨æ§åˆ¶å°è¾“å‡º
    fmt.Println("Hello, WebAssembly!")
    
    // åœ¨æµè§ˆå™¨æ§åˆ¶å°è¾“å‡º
    js.Global().Get("console").Call("log", "Hello from Go WebAssembly!")
    
    // ä¿æŒç¨‹åºè¿è¡Œï¼ˆé‡è¦ï¼ï¼‰
    select {}
}
```

### 3.2 ç¼–è¯‘ä¸ºWebAssembly

```bash
# è®¾ç½®ç¼–è¯‘ç›®æ ‡
export GOOS=js
export GOARCH=wasm

# ç¼–è¯‘
go build -o main.wasm main.go
```

ç¼–è¯‘åä¼šç”Ÿæˆ`main.wasm`æ–‡ä»¶ã€‚

### 3.3 å¤åˆ¶wasm_exec.js

Goæä¾›äº†JavaScriptæ”¯æŒæ–‡ä»¶ï¼Œéœ€è¦å¤åˆ¶åˆ°é¡¹ç›®ç›®å½•ï¼š

```bash
# å¤åˆ¶wasm_exec.js
cp "$(go env GOROOT)/misc/wasm/wasm_exec.js" .
```

### 3.4 åˆ›å»ºHTMLæ–‡ä»¶

åˆ›å»º`index.html`ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Go WebAssembly Example</title>
</head>
<body>
    <h1>Go WebAssembly Demo</h1>
    <div id="output"></div>
    
    <script src="wasm_exec.js"></script>
    <script>
        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
            .then((result) => {
                go.run(result.instance);
            });
    </script>
</body>
</html>
```

### 3.5 è¿è¡Œç¨‹åº

ç”±äºæµè§ˆå™¨çš„å®‰å…¨é™åˆ¶ï¼Œéœ€è¦é€šè¿‡HTTPæœåŠ¡å™¨è¿è¡Œï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶ã€‚

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨Goçš„HTTPæœåŠ¡å™¨

```bash
# å¯åŠ¨HTTPæœåŠ¡å™¨
go run -m http.server 8080
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š`http://localhost:8080`

#### æ–¹å¼äºŒï¼šä½¿ç”¨Python HTTPæœåŠ¡å™¨

```bash
# Python 3
python3 -m http.server 8080

# Python 2
python -m SimpleHTTPServer 8080
```

#### æ–¹å¼ä¸‰ï¼šä½¿ç”¨Node.js HTTPæœåŠ¡å™¨

```bash
# å®‰è£…http-server
npm install -g http-server

# å¯åŠ¨æœåŠ¡å™¨
http-server -p 8080
```

### 3.6 æŸ¥çœ‹ç»“æœ

æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰ï¼Œåœ¨Consoleæ ‡ç­¾é¡µä¸­åº”è¯¥èƒ½çœ‹åˆ°ï¼š

```
Hello, WebAssembly!
Hello from Go WebAssembly!
```

## å››ã€ç†è§£ä»£ç ç»“æ„

### 4.1 mainå‡½æ•°

```go
func main() {
    // Goä»£ç 
    fmt.Println("Hello, WebAssembly!")
    
    // è°ƒç”¨JavaScript
    js.Global().Get("console").Call("log", "Hello from Go WebAssembly!")
    
    // ä¿æŒç¨‹åºè¿è¡Œ
    select {}
}
```

**é‡è¦**ï¼š`select {}`ç”¨äºä¿æŒç¨‹åºè¿è¡Œã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªï¼Œç¨‹åºä¼šç«‹å³é€€å‡ºã€‚

### 4.2 syscall/jsåŒ…

`syscall/js`åŒ…æä¾›äº†ä¸JavaScriptäº¤äº’çš„APIï¼š

- `js.Global()`ï¼šè·å–å…¨å±€å¯¹è±¡ï¼ˆwindowï¼‰
- `Get()`ï¼šè·å–å¯¹è±¡å±æ€§
- `Call()`ï¼šè°ƒç”¨å‡½æ•°
- `Set()`ï¼šè®¾ç½®å±æ€§

### 4.3 wasm_exec.js

`wasm_exec.js`æ˜¯Goæä¾›çš„JavaScriptæ”¯æŒæ–‡ä»¶ï¼Œè´Ÿè´£ï¼š
- åŠ è½½WebAssemblyæ¨¡å—
- æä¾›Goè¿è¡Œæ—¶ç¯å¢ƒ
- å¤„ç†Goå’ŒJavaScriptä¹‹é—´çš„è°ƒç”¨

## äº”ã€æ”¹è¿›ç¤ºä¾‹ï¼šåœ¨é¡µé¢æ˜¾ç¤ºå†…å®¹

### 5.1 æ›´æ–°Goä»£ç 

```go
package main

import (
    "syscall/js"
)

func main() {
    // è·å–documentå¯¹è±¡
    doc := js.Global().Get("document")
    
    // åˆ›å»ºh1å…ƒç´ 
    h1 := doc.Call("createElement", "h1")
    h1.Set("innerHTML", "Hello from Go WebAssembly!")
    
    // æ·»åŠ åˆ°body
    body := doc.Call("getElementsByTagName", "body").Index(0)
    body.Call("appendChild", h1)
    
    // åˆ›å»ºpå…ƒç´ 
    p := doc.Call("createElement", "p")
    p.Set("innerHTML", "This content was created by Go code!")
    body.Call("appendChild", p)
    
    // ä¿æŒç¨‹åºè¿è¡Œ
    select {}
}
```

### 5.2 æ›´æ–°HTML

```html
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Go WebAssembly Example</title>
</head>
<body>
    <script src="wasm_exec.js"></script>
    <script>
        const go = new Go();
        WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
            .then((result) => {
                go.run(result.instance);
            })
            .catch((err) => {
                console.error("åŠ è½½WebAssemblyå¤±è´¥:", err);
            });
    </script>
</body>
</html>
```

### 5.3 é‡æ–°ç¼–è¯‘å’Œè¿è¡Œ

```bash
# é‡æ–°ç¼–è¯‘
go build -o main.wasm main.go

# å¯åŠ¨HTTPæœåŠ¡å™¨
go run -m http.server 8080
```

åˆ·æ–°æµè§ˆå™¨ï¼Œåº”è¯¥èƒ½çœ‹åˆ°Goä»£ç åˆ›å»ºçš„HTMLå…ƒç´ ã€‚

## å…­ã€è°ƒè¯•æŠ€å·§

### 6.1 ä½¿ç”¨fmt.Println

```go
import "fmt"

func main() {
    fmt.Println("è°ƒè¯•ä¿¡æ¯ï¼šç¨‹åºå¼€å§‹æ‰§è¡Œ")
    // ... ä»£ç  ...
    fmt.Println("è°ƒè¯•ä¿¡æ¯ï¼šç¨‹åºæ‰§è¡Œå®Œæˆ")
}
```

è¾“å‡ºä¼šæ˜¾ç¤ºåœ¨æµè§ˆå™¨æ§åˆ¶å°ã€‚

### 6.2 ä½¿ç”¨console.log

```go
js.Global().Get("console").Call("log", "è°ƒè¯•ä¿¡æ¯")
```

### 6.3 ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·

1. **Sourcesæ ‡ç­¾**ï¼šæŸ¥çœ‹WebAssemblyä»£ç 
2. **Consoleæ ‡ç­¾**ï¼šæŸ¥çœ‹è¾“å‡ºå’Œé”™è¯¯
3. **Networkæ ‡ç­¾**ï¼šæŸ¥çœ‹wasmæ–‡ä»¶åŠ è½½æƒ…å†µ

### 6.4 å¯ç”¨Source Mapsï¼ˆå¦‚æœæ”¯æŒï¼‰

```bash
# ç¼–è¯‘æ—¶ç”ŸæˆSource Map
go build -o main.wasm -ldflags="-s -w" main.go
```

## ä¸ƒã€å¸¸è§é—®é¢˜è§£å†³

### 7.1 ç¼–è¯‘é”™è¯¯ï¼šGOOSæˆ–GOARCHæœªè®¾ç½®

**é—®é¢˜**ï¼šç¼–è¯‘æ—¶æç¤º`GOOS`æˆ–`GOARCH`æœªè®¾ç½®

**è§£å†³**ï¼š
```bash
export GOOS=js
export GOARCH=wasm
go build -o main.wasm main.go
```

### 7.2 è¿è¡Œæ—¶é”™è¯¯ï¼šwasm_exec.jsæœªæ‰¾åˆ°

**é—®é¢˜**ï¼šæµè§ˆå™¨æ§åˆ¶å°æç¤º`wasm_exec.js`æœªæ‰¾åˆ°

**è§£å†³**ï¼šç¡®ä¿`wasm_exec.js`æ–‡ä»¶åœ¨HTMLæ–‡ä»¶åŒä¸€ç›®å½•ï¼Œå¹¶ä¸”è·¯å¾„æ­£ç¡®ã€‚

### 7.3 ç¨‹åºç«‹å³é€€å‡º

**é—®é¢˜**ï¼šç¨‹åºè¿è¡Œåç«‹å³é€€å‡ºï¼Œçœ‹ä¸åˆ°è¾“å‡º

**è§£å†³**ï¼šåœ¨`main()`å‡½æ•°æœ«å°¾æ·»åŠ `select {}`ä¿æŒç¨‹åºè¿è¡Œã€‚

### 7.4 CORSé”™è¯¯

**é—®é¢˜**ï¼šé€šè¿‡`file://`åè®®æ‰“å¼€HTMLæ–‡ä»¶æ—¶å‡ºç°CORSé”™è¯¯

**è§£å†³**ï¼šå¿…é¡»é€šè¿‡HTTPæœåŠ¡å™¨è¿è¡Œï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶ã€‚

### 7.5 æ¨¡å—åŠ è½½å¤±è´¥

**é—®é¢˜**ï¼šæµè§ˆå™¨æç¤ºWebAssemblyæ¨¡å—åŠ è½½å¤±è´¥

**æ£€æŸ¥**ï¼š
1. ç¡®ä¿wasmæ–‡ä»¶è·¯å¾„æ­£ç¡®
2. ç¡®ä¿HTTPæœåŠ¡å™¨æ­£ç¡®é…ç½®MIMEç±»å‹
3. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯

## å…«ã€å®Œæ•´ç¤ºä¾‹é¡¹ç›®

### 8.1 é¡¹ç›®ç»“æ„

```
wasm-demo/
â”œâ”€â”€ main.go
â”œâ”€â”€ index.html
â”œâ”€â”€ wasm_exec.js
â””â”€â”€ main.wasm (ç¼–è¯‘åç”Ÿæˆ)
```

### 8.2 å®Œæ•´çš„main.go

```go
package main

import (
    "fmt"
    "syscall/js"
)

func main() {
    fmt.Println("Go WebAssemblyç¨‹åºå¯åŠ¨")
    
    // è·å–document
    doc := js.Global().Get("document")
    body := doc.Call("getElementsByTagName", "body").Index(0)
    
    // åˆ›å»ºæ ‡é¢˜
    title := doc.Call("createElement", "h1")
    title.Set("innerHTML", "ğŸ‰ Go WebAssembly ç¤ºä¾‹")
    title.Set("style", "color: #42b983; text-align: center;")
    body.Call("appendChild", title)
    
    // åˆ›å»ºè¯´æ˜
    desc := doc.Call("createElement", "p")
    desc.Set("innerHTML", "è¿™ä¸ªé¡µé¢æ˜¯ç”±Goä»£ç ç”Ÿæˆçš„ï¼")
    desc.Set("style", "text-align: center; font-size: 18px;")
    body.Call("appendChild", desc)
    
    // åˆ›å»ºæŒ‰é’®
    button := doc.Call("createElement", "button")
    button.Set("innerHTML", "ç‚¹å‡»æˆ‘")
    button.Set("style", "display: block; margin: 20px auto; padding: 10px 20px;")
    
    // æ·»åŠ ç‚¹å‡»äº‹ä»¶
    button.Call("addEventListener", "click", js.FuncOf(func(this js.Value, args []js.Value) interface{} {
        js.Global().Get("alert").Invoke("Hello from Go!")
        return nil
    }))
    
    body.Call("appendChild", button)
    
    fmt.Println("é¡µé¢å…ƒç´ åˆ›å»ºå®Œæˆ")
    
    // ä¿æŒç¨‹åºè¿è¡Œ
    select {}
}
```

### 8.3 å®Œæ•´çš„index.html

```html
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go WebAssembly ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <script src="wasm_exec.js"></script>
    <script>
        if (!WebAssembly) {
            alert('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒWebAssembly');
        } else {
            const go = new Go();
            WebAssembly.instantiateStreaming(fetch("main.wasm"), go.importObject)
                .then((result) => {
                    go.run(result.instance);
                })
                .catch((err) => {
                    console.error("åŠ è½½å¤±è´¥:", err);
                    document.body.innerHTML = '<h1 style="color: red;">åŠ è½½WebAssemblyå¤±è´¥</h1>';
                });
        }
    </script>
</body>
</html>
```

### 8.3 ç¼–è¯‘å’Œè¿è¡Œè„šæœ¬

åˆ›å»º`build.sh`ï¼ˆLinux/macOSï¼‰ï¼š

```bash
#!/bin/bash
export GOOS=js
export GOARCH=wasm
go build -o main.wasm main.go
echo "ç¼–è¯‘å®Œæˆï¼"
```

åˆ›å»º`build.bat`ï¼ˆWindowsï¼‰ï¼š

```batch
@echo off
set GOOS=js
set GOARCH=wasm
go build -o main.wasm main.go
echo ç¼–è¯‘å®Œæˆï¼
```

## ä¹ã€ä¸‹ä¸€æ­¥å­¦ä¹ 

å®Œæˆæœ¬è¯¾åï¼Œä½ åº”è¯¥èƒ½å¤Ÿï¼š

- âœ… ç†è§£WebAssemblyçš„åŸºæœ¬æ¦‚å¿µ
- âœ… ç¼–è¯‘Goä»£ç ä¸ºWebAssembly
- âœ… åœ¨æµè§ˆå™¨ä¸­è¿è¡ŒWebAssemblyæ¨¡å—
- âœ… ä½¿ç”¨syscall/jsåŒ…è¿›è¡ŒåŸºæœ¬æ“ä½œ
- âœ… è°ƒè¯•WebAssemblyç¨‹åº

æ¥ä¸‹æ¥å¯ä»¥å­¦ä¹ ï¼š

1. **ç¬¬2è¯¾ï¼šGoä¸JavaScriptäº¤äº’** - æ·±å…¥å­¦ä¹ Goå’ŒJavaScriptä¹‹é—´çš„å‡½æ•°è°ƒç”¨
2. **ç¬¬3è¯¾ï¼šDOMæ“ä½œ** - ä½¿ç”¨Goæ“ä½œDOMå…ƒç´ å’Œå¤„ç†äº‹ä»¶

## åã€æ€»ç»“

- WebAssemblyæ˜¯ä¸€ç§é«˜æ€§èƒ½çš„WebæŠ€æœ¯
- Goä»1.11ç‰ˆæœ¬å¼€å§‹æ”¯æŒç¼–è¯‘ä¸ºWebAssembly
- ä½¿ç”¨`GOOS=js GOARCH=wasm`ç¼–è¯‘ç›®æ ‡
- `syscall/js`åŒ…æä¾›ä¸JavaScriptäº¤äº’çš„API
- å¿…é¡»é€šè¿‡HTTPæœåŠ¡å™¨è¿è¡Œï¼Œä¸èƒ½ç›´æ¥æ‰“å¼€HTMLæ–‡ä»¶
- ä½¿ç”¨`select {}`ä¿æŒç¨‹åºè¿è¡Œ

æŒæ¡è¿™äº›åŸºç¡€çŸ¥è¯†åï¼Œä½ å°±å¯ä»¥ç»§ç»­å­¦ä¹ æ›´é«˜çº§çš„WebAssemblyåº”ç”¨äº†ï¼
