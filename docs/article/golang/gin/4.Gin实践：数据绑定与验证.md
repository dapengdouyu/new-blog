---
title: 4ã€Ginå®è·µï¼šæ•°æ®ç»‘å®šä¸éªŒè¯
date: 2026-01-06
description: æ·±å…¥ç†è§£Ginæ¡†æ¶çš„æ•°æ®ç»‘å®šæœºåˆ¶å’Œæ•°æ®éªŒè¯
---

# 4ã€Ginå®è·µï¼šæ•°æ®ç»‘å®šä¸éªŒè¯

æœ¬æ–‡æ¡£æ·±å…¥è®²è§£Ginæ¡†æ¶çš„æ•°æ®ç»‘å®šæœºåˆ¶å’Œæ•°æ®éªŒè¯æ–¹æ³•ã€‚

## ğŸ¯ æœ¬è¯¾å­¦ä¹ ç›®æ ‡

å®Œæˆæœ¬è¯¾åï¼Œä½ å°†èƒ½å¤Ÿï¼š
- âœ… æŒæ¡å„ç§æ•°æ®ç»‘å®šæ–¹æ³•
- âœ… å­¦ä¼šä½¿ç”¨validatorè¿›è¡Œæ•°æ®éªŒè¯
- âœ… ç†è§£æ–‡ä»¶ä¸Šä¼ çš„å¤„ç†
- âœ… æŒæ¡è‡ªå®šä¹‰éªŒè¯è§„åˆ™
- âœ… ç†è§£æ•°æ®ç»‘å®šçš„æœ€ä½³å®è·µ

---

## ä¸€ã€æ•°æ®ç»‘å®šåŸºç¡€

### 1.1 ä»€ä¹ˆæ˜¯æ•°æ®ç»‘å®šï¼Ÿ

æ•°æ®ç»‘å®šæ˜¯å°†HTTPè¯·æ±‚ä¸­çš„æ•°æ®ï¼ˆJSONã€è¡¨å•ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰è‡ªåŠ¨æ˜ å°„åˆ°Goç»“æ„ä½“çš„è¿‡ç¨‹ã€‚

### 1.2 ç»‘å®šæ–¹æ³•å¯¹æ¯”

| æ–¹æ³• | è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|------|------|----------|
| `ShouldBind` | ç»‘å®šåˆ°ç»“æ„ä½“ï¼Œé”™è¯¯ä¸ä¸­æ–­ | éœ€è¦æ‰‹åŠ¨å¤„ç†é”™è¯¯ |
| `MustBind` | ç»‘å®šåˆ°ç»“æ„ä½“ï¼Œé”™è¯¯è‡ªåŠ¨è¿”å›400 | ç®€å•åœºæ™¯ |
| `ShouldBindJSON` | ç»‘å®šJSONæ•°æ® | APIæ¥å£ |
| `ShouldBindQuery` | ç»‘å®šæŸ¥è¯¢å‚æ•° | GETè¯·æ±‚ |
| `ShouldBindUri` | ç»‘å®šè·¯å¾„å‚æ•° | RESTful API |
| `ShouldBindForm` | ç»‘å®šè¡¨å•æ•°æ® | è¡¨å•æäº¤ |

---

## äºŒã€JSONæ•°æ®ç»‘å®š

### 2.1 åŸºæœ¬ç”¨æ³•

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type User struct {
    Name  string `json:"name"`
    Email string `json:"email"`
    Age   int    `json:"age"`
}

func main() {
    r := gin.Default()
    
    r.POST("/users", func(c *gin.Context) {
        var user User
        
        // ç»‘å®šJSONæ•°æ®
        if err := c.ShouldBindJSON(&user); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message": "User created",
            "user":    user,
        })
    })
    
    r.Run()
}
```

### 2.2 å¤„ç†ç»‘å®šé”™è¯¯

```go
r.POST("/users", func(c *gin.Context) {
    var user User
    
    if err := c.ShouldBindJSON(&user); err != nil {
        // è·å–è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
        if err.Error() == "EOF" {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": "Request body is empty",
            })
            return
        }
        
        c.JSON(http.StatusBadRequest, gin.H{
            "error":   "Invalid request data",
            "details": err.Error(),
        })
        return
    }
    
    c.JSON(http.StatusOK, user)
})
```

### 2.3 åµŒå¥—ç»“æ„ä½“ç»‘å®š

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type Address struct {
    Street  string `json:"street"`
    City    string `json:"city"`
    Country string `json:"country"`
}

type User struct {
    Name    string  `json:"name"`
    Email   string  `json:"email"`
    Address Address `json:"address"`
}

func main() {
    r := gin.Default()
    
    r.POST("/users", func(c *gin.Context) {
        var user User
        
        if err := c.ShouldBindJSON(&user); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{"error": err.Error()})
            return
        }
        
        c.JSON(http.StatusOK, user)
    })
    
    r.Run()
}
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š

```json
{
  "name": "Alice",
  "email": "alice@example.com",
  "address": {
    "street": "123 Main St",
    "city": "Beijing",
    "country": "China"
  }
}
```

---

## ä¸‰ã€æŸ¥è¯¢å‚æ•°ç»‘å®š

### 3.1 åŸºæœ¬ç”¨æ³•

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type Pagination struct {
    Page  int `form:"page" binding:"min=1"`
    Limit int `form:"limit" binding:"min=1,max=100"`
}

func main() {
    r := gin.Default()
    
    r.GET("/users", func(c *gin.Context) {
        var pagination Pagination
        
        // ç»‘å®šæŸ¥è¯¢å‚æ•°
        if err := c.ShouldBindQuery(&pagination); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "page":  pagination.Page,
            "limit": pagination.Limit,
        })
    })
    
    r.Run()
}
```

**è¯·æ±‚ç¤ºä¾‹**ï¼š`GET /users?page=1&limit=10`

### 3.2 æ··åˆç»‘å®š

åŒæ—¶ç»‘å®šæŸ¥è¯¢å‚æ•°å’Œè·¯å¾„å‚æ•°ï¼š

```go
type UserQuery struct {
    ID   int    `uri:"id" binding:"required"`
    Sort string `form:"sort"`
    Page int    `form:"page" binding:"min=1"`
}

r.GET("/users/:id", func(c *gin.Context) {
    var query UserQuery
    
    // ç»‘å®šURIå‚æ•°å’ŒæŸ¥è¯¢å‚æ•°
    if err := c.ShouldBindUri(&query); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    if err := c.ShouldBindQuery(&query); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(200, query)
})
```

---

## å››ã€è¡¨å•æ•°æ®ç»‘å®š

### 4.1 application/x-www-form-urlencoded

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type LoginForm struct {
    Username string `form:"username" binding:"required"`
    Password string `form:"password" binding:"required,min=6"`
}

func main() {
    r := gin.Default()
    
    r.POST("/login", func(c *gin.Context) {
        var form LoginForm
        
        // ç»‘å®šè¡¨å•æ•°æ®
        if err := c.ShouldBind(&form); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message": "Login successful",
        })
    })
    
    r.Run()
}
```

### 4.2 multipart/form-data

```go
type UploadForm struct {
    File        *multipart.FileHeader `form:"file" binding:"required"`
    Description string                 `form:"description"`
}

r.POST("/upload", func(c *gin.Context) {
    var form UploadForm
    
    if err := c.ShouldBind(&form); err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    // ä¿å­˜æ–‡ä»¶
    filename := filepath.Base(form.File.Filename)
    if err := c.SaveUploadedFile(form.File, "./uploads/"+filename); err != nil {
        c.JSON(500, gin.H{"error": err.Error()})
        return
    }
    
    c.JSON(200, gin.H{
        "filename":    filename,
        "description": form.Description,
    })
})
```

---

## äº”ã€æ•°æ®éªŒè¯

### 5.1 å®‰è£…validator

Ginä½¿ç”¨`go-playground/validator`è¿›è¡Œæ•°æ®éªŒè¯ï¼š

```bash
go get github.com/go-playground/validator/v10
```

### 5.2 åŸºæœ¬éªŒè¯æ ‡ç­¾

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
)

type User struct {
    Name     string `json:"name" binding:"required,min=2,max=50"`
    Email    string `json:"email" binding:"required,email"`
    Age      int    `json:"age" binding:"required,min=18,max=120"`
    Password string `json:"password" binding:"required,min=8"`
}

func main() {
    r := gin.Default()
    
    r.POST("/users", func(c *gin.Context) {
        var user User
        
        if err := c.ShouldBindJSON(&user); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message": "User created",
            "user":    user,
        })
    })
    
    r.Run()
}
```

### 5.3 å¸¸ç”¨éªŒè¯æ ‡ç­¾

| æ ‡ç­¾ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `required` | å¿…å¡«å­—æ®µ | `binding:"required"` |
| `min` | æœ€å°å€¼ï¼ˆæ•°å­—/å­—ç¬¦ä¸²é•¿åº¦ï¼‰ | `binding:"min=1"` |
| `max` | æœ€å¤§å€¼ï¼ˆæ•°å­—/å­—ç¬¦ä¸²é•¿åº¦ï¼‰ | `binding:"max=100"` |
| `email` | é‚®ç®±æ ¼å¼ | `binding:"email"` |
| `url` | URLæ ¼å¼ | `binding:"url"` |
| `oneof` | æšä¸¾å€¼ | `binding:"oneof=red green blue"` |
| `len` | å›ºå®šé•¿åº¦ | `binding:"len=10"` |
| `gte` | å¤§äºç­‰äº | `binding:"gte=0"` |
| `lte` | å°äºç­‰äº | `binding:"lte=100"` |
| `gt` | å¤§äº | `binding:"gt=0"` |
| `lt` | å°äº | `binding:"lt=100"` |

### 5.4 è‡ªå®šä¹‰éªŒè¯é”™è¯¯æ¶ˆæ¯

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/go-playground/validator/v10"
    "net/http"
    "reflect"
)

type User struct {
    Name  string `json:"name" binding:"required,min=2" msg:"å§“åå¿…å¡«ä¸”è‡³å°‘2ä¸ªå­—ç¬¦"`
    Email string `json:"email" binding:"required,email" msg:"é‚®ç®±å¿…å¡«ä¸”æ ¼å¼æ­£ç¡®"`
    Age   int    `json:"age" binding:"required,min=18" msg:"å¹´é¾„å¿…å¡«ä¸”è‡³å°‘18å²"`
}

func GetValidationError(err error, obj interface{}) map[string]string {
    errors := make(map[string]string)
    
    if validationErrors, ok := err.(validator.ValidationErrors); ok {
        objType := reflect.TypeOf(obj).Elem()
        
        for _, fieldError := range validationErrors {
            field, _ := objType.FieldByName(fieldError.Field())
            msg := field.Tag.Get("msg")
            if msg == "" {
                msg = fieldError.Error()
            }
            errors[fieldError.Field()] = msg
        }
    }
    
    return errors
}

func main() {
    r := gin.Default()
    
    r.POST("/users", func(c *gin.Context) {
        var user User
        
        if err := c.ShouldBindJSON(&user); err != nil {
            errors := GetValidationError(err, &user)
            c.JSON(http.StatusBadRequest, gin.H{
                "error":  "Validation failed",
                "errors": errors,
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message": "User created",
            "user":    user,
        })
    })
    
    r.Run()
}
```

---

## å…­ã€è‡ªå®šä¹‰éªŒè¯è§„åˆ™

### 6.1 æ³¨å†Œè‡ªå®šä¹‰éªŒè¯å™¨

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/go-playground/validator/v10"
    "net/http"
    "regexp"
)

var validate *validator.Validate

// è‡ªå®šä¹‰éªŒè¯ï¼šæ‰‹æœºå·
func validateMobile(fl validator.FieldLevel) bool {
    mobile := fl.Field().String()
    matched, _ := regexp.MatchString(`^1[3-9]\d{9}$`, mobile)
    return matched
}

// è‡ªå®šä¹‰éªŒè¯ï¼šå¯†ç å¼ºåº¦
func validatePassword(fl validator.FieldLevel) bool {
    password := fl.Field().String()
    // è‡³å°‘åŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
    hasUpper := regexp.MustCompile(`[A-Z]`).MatchString(password)
    hasLower := regexp.MustCompile(`[a-z]`).MatchString(password)
    hasNumber := regexp.MustCompile(`[0-9]`).MatchString(password)
    return hasUpper && hasLower && hasNumber
}

func init() {
    validate = validator.New()
    validate.RegisterValidation("mobile", validateMobile)
    validate.RegisterValidation("strong_password", validatePassword)
}

type User struct {
    Name     string `json:"name" binding:"required"`
    Mobile   string `json:"mobile" binding:"required,mobile"`
    Password string `json:"password" binding:"required,min=8,strong_password"`
}

func main() {
    r := gin.Default()
    
    // è®¾ç½®è‡ªå®šä¹‰éªŒè¯å™¨
    if v, ok := r.Engine.Validator.(*validator.Validate); ok {
        v.RegisterValidation("mobile", validateMobile)
        v.RegisterValidation("strong_password", validatePassword)
    }
    
    r.POST("/users", func(c *gin.Context) {
        var user User
        
        if err := c.ShouldBindJSON(&user); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message": "User created",
        })
    })
    
    r.Run()
}
```

### 6.2 è·¨å­—æ®µéªŒè¯

```go
type RegisterForm struct {
    Password        string `json:"password" binding:"required,min=8"`
    ConfirmPassword string `json:"confirm_password" binding:"required"`
}

func validatePasswordMatch(fl validator.FieldLevel) bool {
    form := fl.Parent().Interface().(RegisterForm)
    return form.Password == form.ConfirmPassword
}

// ä½¿ç”¨
type RegisterForm struct {
    Password        string `json:"password" binding:"required,min=8"`
    ConfirmPassword string `json:"confirm_password" binding:"required,eqfield=Password"`
}
```

---

## ä¸ƒã€æ–‡ä»¶ä¸Šä¼ 

### 7.1 å•æ–‡ä»¶ä¸Šä¼ 

```go
package main

import (
    "github.com/gin-gonic/gin"
    "net/http"
    "path/filepath"
)

func main() {
    r := gin.Default()
    
    r.POST("/upload", func(c *gin.Context) {
        // è·å–ä¸Šä¼ çš„æ–‡ä»¶
        file, err := c.FormFile("file")
        if err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": "File is required",
            })
            return
        }
        
        // éªŒè¯æ–‡ä»¶ç±»å‹
        ext := filepath.Ext(file.Filename)
        allowedExts := []string{".jpg", ".jpeg", ".png", ".gif"}
        valid := false
        for _, allowedExt := range allowedExts {
            if ext == allowedExt {
                valid = true
                break
            }
        }
        if !valid {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": "Invalid file type",
            })
            return
        }
        
        // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ10MBï¼‰
        if file.Size > 10*1024*1024 {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": "File too large",
            })
            return
        }
        
        // ä¿å­˜æ–‡ä»¶
        filename := filepath.Base(file.Filename)
        if err := c.SaveUploadedFile(file, "./uploads/"+filename); err != nil {
            c.JSON(http.StatusInternalServerError, gin.H{
                "error": "Failed to save file",
            })
            return
        }
        
        c.JSON(http.StatusOK, gin.H{
            "message":  "File uploaded successfully",
            "filename": filename,
            "size":     file.Size,
        })
    })
    
    r.Run()
}
```

### 7.2 å¤šæ–‡ä»¶ä¸Šä¼ 

```go
r.POST("/upload-multiple", func(c *gin.Context) {
    form, err := c.MultipartForm()
    if err != nil {
        c.JSON(400, gin.H{"error": err.Error()})
        return
    }
    
    files := form.File["files"]
    
    var uploadedFiles []string
    for _, file := range files {
        filename := filepath.Base(file.Filename)
        if err := c.SaveUploadedFile(file, "./uploads/"+filename); err != nil {
            continue
        }
        uploadedFiles = append(uploadedFiles, filename)
    }
    
    c.JSON(200, gin.H{
        "uploaded": uploadedFiles,
        "count":    len(uploadedFiles),
    })
})
```

---

## å…«ã€ç»¼åˆç¤ºä¾‹

åˆ›å»ºä¸€ä¸ªå®Œæ•´çš„ç”¨æˆ·æ³¨å†ŒAPIï¼š

```go
package main

import (
    "github.com/gin-gonic/gin"
    "github.com/go-playground/validator/v10"
    "net/http"
    "regexp"
)

var validate *validator.Validate

func validateMobile(fl validator.FieldLevel) bool {
    mobile := fl.Field().String()
    matched, _ := regexp.MatchString(`^1[3-9]\d{9}$`, mobile)
    return matched
}

func init() {
    validate = validator.New()
    validate.RegisterValidation("mobile", validateMobile)
}

type RegisterRequest struct {
    Username        string `json:"username" binding:"required,min=3,max=20"`
    Email           string `json:"email" binding:"required,email"`
    Mobile          string `json:"mobile" binding:"required,mobile"`
    Password        string `json:"password" binding:"required,min=8"`
    ConfirmPassword string `json:"confirm_password" binding:"required,eqfield=Password"`
    Age             int    `json:"age" binding:"required,min=18,max=120"`
}

func main() {
    r := gin.Default()
    
    if v, ok := r.Engine.Validator.(*validator.Validate); ok {
        v.RegisterValidation("mobile", validateMobile)
    }
    
    r.POST("/register", func(c *gin.Context) {
        var req RegisterRequest
        
        if err := c.ShouldBindJSON(&req); err != nil {
            c.JSON(http.StatusBadRequest, gin.H{
                "error": err.Error(),
            })
            return
        }
        
        // ä¸šåŠ¡é€»è¾‘å¤„ç†
        c.JSON(http.StatusOK, gin.H{
            "message": "Registration successful",
            "user": gin.H{
                "username": req.Username,
                "email":    req.Email,
                "mobile":   req.Mobile,
            },
        })
    })
    
    r.Run(":8080")
}
```

---

## æ€»ç»“

1. **æ•°æ®ç»‘å®š**ï¼šä½¿ç”¨`ShouldBind*`ç³»åˆ—æ–¹æ³•ç»‘å®šå„ç§æ•°æ®æº
2. **æ•°æ®éªŒè¯**ï¼šä½¿ç”¨`binding`æ ‡ç­¾å’Œvalidatorè¿›è¡ŒéªŒè¯
3. **è‡ªå®šä¹‰éªŒè¯**ï¼šæ³¨å†Œè‡ªå®šä¹‰éªŒè¯è§„åˆ™
4. **æ–‡ä»¶ä¸Šä¼ **ï¼šå¤„ç†å•æ–‡ä»¶å’Œå¤šæ–‡ä»¶ä¸Šä¼ 
5. **é”™è¯¯å¤„ç†**ï¼šæä¾›å‹å¥½çš„éªŒè¯é”™è¯¯æ¶ˆæ¯

**ä¸‹ä¸€æ­¥**ï¼šå­¦ä¹ [ç¬¬5è¯¾ï¼šé¡¹ç›®ç»“æ„ä¸æœ€ä½³å®è·µ](./5.Giné«˜çº§ï¼šé¡¹ç›®ç»“æ„ä¸æœ€ä½³å®è·µ.md)ï¼Œäº†è§£å¦‚ä½•ç»„ç»‡å¤§å‹Giné¡¹ç›®ã€‚
